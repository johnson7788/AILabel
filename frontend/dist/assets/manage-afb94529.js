import{d as P,L as z,g as m,k as F,h as J,r as Q,o as a,b as n,f as j,a as e,F as v,e as g,A as h,J as A,t as d,i as u,O as f,p as T,M as G,P as H,C as I,E as y}from"./index-f50d6d08.js";import{a as K,_ as W}from"./navHeader.vue_vue_type_script_setup_true_lang-5f81fcc5.js";import{a as X,n as Y,b as Z,d as B,o as ee,p as te,r as le}from"./api-e233926e.js";import"./axios-a342f982.js";const se={class:"main flex border rounded-xl overflow-hidden my-4 flex-wrap"},oe=["value"],ae={class:"title px-2"},ne={class:"main flex border rounded-full overflow-hidden my-4"},ie=["value"],re={class:"flex items-center m-2 cursor-pointer cm-toggle-wrapper mb-6"},de=e("span",{class:"font-semibold text-xs mr-1"}," 是否使用模型缓存： ",-1),ue=e("span",{class:"font-semibold text-xs ml-6 mr-1"}," 是否采样数据去重已标注： ",-1),ce={class:"flex flex-row items-center"},me=e("p",{class:"ml-4"},"标注配置: ",-1),pe=["value","name"],ve={class:"hover:bg-gray-50 flex items-center justify-between px-3 py-1 border-2 rounded-lg cursor-pointer text-sm border-gray-200 group peer-checked:border-blue-500"},fe={class:"font-medium text-gray-700"},be=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-9 h-9 text-blue-600 invisible group-[.peer:checked+&]:visible"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),_e=e("div",{class:"divider"},null,-1),xe={class:"flex flex-row justify-between items-center ml-2"},ge=e("option",{disabled:"",selected:""},"使用哪个Sample",-1),he=["max"],we=e("div",{class:"divider"},null,-1),ye=e("p",{class:"text-2xl text-green-800 text-center"},"可用tools函数展示:",-1),ke={class:"p-24 flex flex-wrap items-center justify-center"},Le={class:"absolute bottom-0 left-0 mb-8",viewBox:"0 0 375 283",fill:"none",style:{transform:"scale(1.5)",opacity:"0.1"}},Ve=e("rect",{x:"159.52",y:"175",width:"152",height:"152",rx:"8",transform:"rotate(-45 159.52 175)",fill:"white"},null,-1),Ce=e("rect",{y:"107.48",width:"152",height:"152",rx:"8",transform:"rotate(-45 0 107.48)",fill:"white"},null,-1),Me=[Ve,Ce],je=e("div",{class:"relative pt-4 px-6 flex items-center justify-center"},[e("div",{class:"block absolute w-48 h-48 bottom-0 left-0 -mb-24 ml-3",style:{background:"radial-gradient(black, transparent 60%)",transform:"rotate3d(0, 0, 1, 20deg) scale3d(1, 0.6, 1)",opacity:"0.2"}})],-1),De={class:"relative text-black px-6 pb-6 mt-6"},Ue={class:"block opacity-75 -mb-1 text-center text-2xl text-green-600"},Se={class:"flex justify-between"},Ae={class:"block font-semibold text-sm"},Oe=P({__name:"manage",setup(Be){const{selectedLLM:c,selectedSample:p,sample_idx:b,usecache:k,norepeat:L,label2page:R,defaultLabel:V}=z(K()),C=m([]),D=m([]),_=m([]),x=m(0),U=m([]),w=m([]),S=m(null);F(p,(s,l)=>{x.value=_.value.filter(r=>r.prompt===s)[0].number,console.log("total_question_num",x.value),b.value=0});async function q(){console.log("下载数据，prompts包括",w);const s=S.value.filter(i=>w.value.includes(i.prompt_name)),l=JSON.stringify(s,null,2),r=new Blob([l],{type:"application/json"}),t=URL.createObjectURL(r),o=document.createElement("a");o.href=t,o.setAttribute("download","output.json"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}function E(){for(let s of C.value)if(c.value.includes(s.name)){const l=c.value.indexOf(s.name);c.value.splice(l,1)}else s.status==="ok"&&c.value.push(s.name)}async function N(){console.log("清空数据库"),await ee();const l=(await B({mode:"detail"})).data.length;l===0?y({message:"清空数据库成功",type:"info"}):y({message:`清空数据库失败，还剩余 ${l} 条数据`,type:"error"})}async function O(){const s=await te();y({message:`导出数据成功，请查看导出文件: ${s.data}`,type:"info"})}async function $(){const s=await le();y({message:`备份mongo数据成功，请查看导出文件: ${s.data}`,type:"info"})}return J(async()=>{const s=await X();console.log(s),D.value=s.data;const l=await Y();console.log("llm_res",l),C.value=l.data;const r=await Z({keyword:"empty",namelength:!0});_.value=r.data,console.log(_.value),p.value!==""&&(x.value=_.value.filter(M=>M.prompt===p.value)[0].number);const t=await B({mode:"detail",limit:-1});S.value=t.data,console.log(t);const o=t.data.map(M=>M.prompt_name),i=[...new Set(o)];U.value=i}),(s,l)=>{const r=Q("el-switch");return a(),n(v,null,[j(W),e("div",null,[e("div",{class:"main my-6 flex ml-2"},[e("button",{class:"btn btn-outline btn-accent",onClick:N},"清空标注数据库"),e("button",{class:"btn btn-outline btn-accent",onClick:O},"导出标注数据"),e("button",{class:"btn btn-outline btn-accent",onClick:$},"备份mongo")]),e("div",se,[e("div",{class:"title py-3 my-auto px-5 bg-green-400 text-white text-sm font-semibold mr-3 hover:bg-green-700 cursor-pointer",onClick:q,title:"下载选中的prompt的数据"},"下载"),(a(!0),n(v,null,g(U.value,(t,o)=>(a(),n("label",{class:"flex p-2 cursor-pointer",key:t},[h(e("input",{class:"my-auto transform scale-125",type:"checkbox",name:"sfg","onUpdate:modelValue":l[0]||(l[0]=i=>w.value=i),value:t},null,8,oe),[[A,w.value]]),e("div",ae,d(t),1)]))),128))]),e("div",ne,[e("div",{class:"title py-3 my-auto px-5 bg-blue-400 text-white text-sm font-semibold mr-3 hover:bg-blue-700 cursor-pointer",onClick:E,title:"红色表示异常，绿色表示正常"},"LLM"),(a(!0),n(v,null,g(C.value,(t,o)=>(a(),n("label",{class:"flex p-2 cursor-pointer",key:t.name},[h(e("input",{class:"my-auto transform scale-125",type:"checkbox",name:"sfg","onUpdate:modelValue":l[1]||(l[1]=i=>f(c)?c.value=i:null),value:t.name},null,8,ie),[[A,u(c)]]),e("div",{class:T(["title px-2",{"text-red-500":t.status==="error","text-green-500":t.status==="ok"}])},d(t.name),3)]))),128))]),e("div",re,[de,j(r,{modelValue:u(k),"onUpdate:modelValue":l[2]||(l[2]=t=>f(k)?k.value=t:null)},null,8,["modelValue"]),ue,j(r,{modelValue:u(L),"onUpdate:modelValue":l[3]||(l[3]=t=>f(L)?L.value=t:null)},null,8,["modelValue"])]),e("div",ce,[me,(a(!0),n(v,null,g(u(R),(t,o)=>(a(),n("label",null,[h(e("input",{type:"radio",value:o,class:"peer hidden",name:o,"onUpdate:modelValue":l[4]||(l[4]=i=>f(V)?V.value=i:null)},null,8,pe),[[G,u(V)]]),e("div",ve,[e("h2",fe,d(o),1),be])]))),256))]),_e,e("div",xe,[h(e("select",{class:"select select-bordered w-full max-w-xs","onUpdate:modelValue":l[5]||(l[5]=t=>f(p)?p.value=t:null)},[ge,(a(!0),n(v,null,g(_.value,t=>(a(),n("option",null,d(t.prompt),1))),256))],512),[[H,u(p)]]),e("div",null,"问题序号: "+d(u(b))+" / "+d(x.value),1),h(e("input",{class:"rounded-lg overflow-hidden appearance-none bg-gray-400 h-3 w-1/4",type:"range",min:"0",max:x.value,step:"1","onUpdate:modelValue":l[6]||(l[6]=t=>f(b)?b.value=t:null)},null,8,he),[[I,u(b)]])]),we,ye,e("div",ke,[(a(!0),n(v,null,g(D.value,(t,o)=>(a(),n("div",{class:"flex-shrink-0 m-6 relative overflow-hidden bg-slate-200 rounded-lg max-w-xs shadow-lg",key:o},[(a(),n("svg",Le,Me)),je,e("div",De,[e("span",Ue,d(o),1),e("div",Se,[e("span",Ae,d(t),1)])])]))),128))])])],64)}}});export{Oe as default};
