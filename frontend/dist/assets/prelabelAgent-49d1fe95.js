import{d as S,g as r,k as B,h as U,r as g,o as v,b,f as c,a as l,A as j,P as F,F as y,e as L,t as V,w,j as M,E as k}from"./index-f50d6d08.js";import{a as O}from"./axios-a342f982.js";import{_ as Q}from"./navHeader.vue_vue_type_script_setup_true_lang-f1ba1dcd.js";import{f as T,s as G,q as I}from"./api-a3faf747.js";const z={class:"w-full"},H={class:"flex flex-row justify-between items-center ml-2"},J=l("option",{disabled:"",selected:""},"所有prompt对应的问题指令",-1),K={class:"mr-10"},R=l("div",{class:"divider"},null,-1),W={class:"flex float-end"},X=["disabled"],ae=S({__name:"prelabelAgent",setup(Y){const d=r(),_=r(),h=r(0),i=r([]),E="https://ai.minitool.fun:15557",f=r(!1);B(_,async(t,o)=>{h.value=d.value.filter(a=>a.name===t)[0].number,console.log("total_question_num",h.value);const s=d.value.filter(a=>a.name===t)[0].questions;await C(s)});async function $(){const t=i.value.filter(o=>o.checked);console.log("开始对这些questions进行回答:",t),t.forEach(async(o,s)=>{f.value=!0;const a=o.id;let e=[{id:1,role:"user",content:o.question}];const n=await O.post(`${E}/api/answer_messages`,{workflow:!0,messages:e});console.log(n);const u=n.data,q=u.msg;if(u.code==0){const m=u.data,N=m.output,P=m.workflow_output,D=m.intermidiates;e.push({id:e[e.length-1].id+1,role:"SOP",content:P}),D.forEach(p=>{p.status==="AgentAction"?(e.push({id:e[e.length-1].id+1,role:"thought",content:p.thought}),e.push({id:e[e.length-1].id+1,role:"observation",content:p.observation})):e.push({id:e[e.length-1].id+1,role:"thought",content:p.thought})}),e.push({id:e[e.length-1].id+1,role:"assistant",content:N,meta:m});const x=await G({id:a,prompt:_.value,messages:e,collection:"llmlabel"});console.log("save_res",x),x.code===0?k({title:"成功",message:`第${s+1}个问题生成回答成功`,type:"success"}):k({title:"错误",message:`第${s+1}个问题保存回答失败:`+q,type:"warning"})}else k({title:"错误",message:`第${s+1}个问题生成回答失败:`+q,type:"warning"});f.value=!1})}function A(){i.value.forEach(t=>{t.checked=!t.checked})}async function C(t){const o=await I({questions:t});console.log("query_questions result",o);const s=o.data;i.value=s.map(a=>(a.status==="unlabeled"&&(a.checked=!0),a))}return U(async()=>{const t=await T();console.log(t.data),d.value=t.data}),(t,o)=>{const s=g("el-table-column"),a=g("el-checkbox"),e=g("el-table");return v(),b(y,null,[c(Q),l("section",null,[l("div",z,[l("div",H,[j(l("select",{class:"select select-bordered w-full max-w-xs","onUpdate:modelValue":o[0]||(o[0]=n=>_.value=n)},[J,(v(!0),b(y,null,L(d.value,n=>(v(),b("option",null,V(n.name),1))),256))],512),[[F,_.value]]),l("div",K,"问题数量: "+V(h.value),1)]),R]),l("div",W,[l("button",{class:"btn btn-info mr-4",onClick:A},"反选"),l("button",{class:"btn btn-success mr-4",disabled:f.value,onClick:$},"生成",8,X)]),c(e,{data:i.value,style:{width:"100%"},class:"mt-10"},{default:w(()=>[c(s,{prop:"id",label:"id",width:"200"}),c(s,{prop:"question",label:"question",width:"600"}),c(s,{prop:"status",label:"status",width:"200"}),c(s,{fixed:"right",label:"Operations",width:"400"},{default:w(n=>[c(a,{modelValue:i.value[n.$index].checked,"onUpdate:modelValue":u=>i.value[n.$index].checked=u},{default:w(()=>[M("勾选")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])])],64)}}});export{ae as default};
