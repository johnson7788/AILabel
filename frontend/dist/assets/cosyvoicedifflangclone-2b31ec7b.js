import{d as q,g as s,h as G,o as n,b as l,a as e,z as h,t as y,j as A,A as D,C as W,F as z,e as Q,E as r,Q as Y,B as H,q as J,s as K,_ as X}from"./index-f50d6d08.js";import{a as m}from"./axios-a342f982.js";import{W as Z}from"./index-4b1aff9b.js";const p=_=>(J("data-v-ce4f8eaa"),_=_(),K(),_),ee={class:"container mx-auto py-10"},te={class:"flex flex-col sm:flex-row"},oe={class:"bg-white p-8 rounded-lg shadow-md w-full sm:w-1/2 sm:mr-4 mb-4 sm:mb-0"},ae=p(()=>e("p",{class:"text-lg my-2"},"不同语言之间克隆，例如说中文，clone成说英语，请输入TTS文本，请上传或者从右侧选择1个示例声音（无需声音中对应的文字）",-1)),se={key:0},ne=p(()=>e("label",{for:"audio-file",class:"block text-sm font-medium text-gray-700 mb-2"},"上传参考或录制声音文件",-1)),le={class:"flex justify-between items-center h-16 mb-8 space-x-4"},re={key:0,class:"w-2/3"},ce=p(()=>e("div",{class:"border h-full"},null,-1)),ie={key:1,class:"w-1/3"},ue={key:1,class:"flex justify-between items-center bg-white p-4 rounded shadow hover:shadow-lg transition-shadow"},de={class:"text-green-700"},fe={class:"mb-4"},pe=p(()=>e("label",{for:"ttsText",class:"block text-sm font-medium text-gray-700 mb-2"},"TTS对应文本",-1)),ve=["src"],_e=["href"],ge={class:"w-full sm:w-1/2"},he={key:0,class:"space-y-4"},ye=p(()=>e("h2",{class:"text-2xl font-bold text-gray-800"},"选择或者试听文件",-1)),me={class:"grid grid-cols-1 gap-4"},we={class:"text-gray-700"},be=["onClick"],xe=["onClick"],ke={key:1,class:"text-center py-5"},Ce=p(()=>e("p",{class:"text-gray-500"},"没有找到Audio文件，请检查服务器是否正常",-1)),$e=[Ce],Re=q({__name:"cosyvoicedifflangclone",setup(_){const c="https://ai.minitool.fun:15302",w=s([]),b=s(null),S=s(null),i=s(),x=s("你好啊，我是AI机器人"),u=s(null),d=s(),g=s(!1),f=s(null),k=s(!0),C=s(!0),$=s(!0),R=s(!1);function F(t){d.value=t.name,k.value=!1}const P=t=>{C.value=!1;const o=t.target;o.files&&(u.value=o.files[0]),r({title:"上传完成",message:"可以点击克隆了",type:"success"})},I=async()=>{$.value=!1;try{const t=Y([]),o=await navigator.mediaDevices.getUserMedia({audio:!0});f.value=new MediaRecorder(o),f.value.ondataavailable=a=>{t.push(a.data)},f.value.onstop=async()=>{const v=await new Blob(t).arrayBuffer(),B=await new AudioContext().decodeAudioData(v),U=[];for(let T=0;T<B.numberOfChannels;T++)U.push(B.getChannelData(T));const V=await Z.encode({sampleRate:B.sampleRate,channelData:U}),O=new Blob([V],{type:"audio/wav"});u.value=new File([O],"recorded_audio.wav",{type:"audio/wav"})},f.value.start(),g.value=!0,r({title:"录制完成",message:"可以点击克隆了",type:"success"})}catch(t){console.error("不能获取麦克风:",t)}},j=()=>{f.value&&(f.value.stop(),g.value=!1)},L=async()=>{if(!u.value&&!d.value){alert("请首先选择参考音频或者上传音频文件或者录音");return}R.value=!0;let t=`tts_text=${encodeURIComponent(x.value)}`;d.value&&(t+=`&wav_path=${encodeURIComponent(d.value)}`);try{if(u.value){const o=new FormData;o.append("prompt_wav",u.value);const v=await(await m.post(`${c}/api/inference_cross_lingual_upload?${t}`,o,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"})).data;i.value=URL.createObjectURL(v),u.value=null}else{const a=await(await m.get(`${c}/api/inference_cross_lingual_wav_path?${t}`,{responseType:"blob"})).data;i.value=URL.createObjectURL(a),d.value=""}}catch(o){console.error("推理失败，请检查服务器:",o),alert(`推理失败，请检查服务器,${o}`)}R.value=!1,$.value=!0,C.value=!0,k.value=!0},E=async()=>{try{const t=await m.get(`${c}/api/get_reference_audio`);t.data.code===0?(w.value=t.data.data,r({title:"音频文件获取成功",message:"音频文件已成功获取！",type:"success"})):r({title:"获取音频文件错误",message:"获取音频文件失败，请重试。",type:"error"})}catch(t){r({title:"获取音频文件错误",message:"获取音频文件失败，请重试。",type:"error"}),console.error("Error fetching audio files:",t)}},M=t=>{const o=`${c}/api/audio/${t}`;b.value.src=o,b.value.play()};async function N(){try{(await m.get(`${c}/ping`)).data==="Pong"?r({title:"连接服务器成功",message:"开始获取数据",type:"success"}):r({title:"服务器没有返回Pong",message:`请联系管理员检查服务器地址${c}`,type:"error"})}catch(t){r({title:"连接服务器失败",message:`请检查网络连接${c},${t}`,type:"error"})}}return G(async()=>{await N(),await E()}),(t,o)=>(n(),l("div",ee,[e("div",te,[e("div",oe,[ae,k.value?(n(),l("div",se,[ne,e("div",le,[$.value?(n(),l("div",re,[e("input",{type:"file",id:"audio-file",accept:"audio/*",onChange:P,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,32)])):h("",!0),ce,C.value?(n(),l("div",ie,[e("button",{onClick:o[0]||(o[0]=a=>g.value?j():I()),class:"w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"},y(g.value?"停止录制":"开始录制"),1)])):h("",!0)])])):(n(),l("div",ue,[A(" 声音: "),e("span",de,y(d.value),1)])),e("div",fe,[pe,D(e("textarea",{id:"ttsText","onUpdate:modelValue":o[1]||(o[1]=a=>x.value=a),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入TTS文本"},null,512),[[W,x.value]])]),e("div",null,[e("button",{onClick:L,class:"w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"},y(R.value?"加载中...":"克隆音频"),1)]),i.value?(n(),l("audio",{key:2,ref_key:"audioGeneratePlayer",ref:S,controls:"",class:"my-6"},[e("source",{src:i.value,type:"audio/wav"},null,8,ve),A(" Your browser does not support the audio tag. ")],512)):h("",!0),i.value?(n(),l("a",{key:3,href:i.value,download:"tts_audio.wav",class:"mt-4 bg-green-500 text-white py-2 px-4 rounded"}," 下载音频 ",8,_e)):h("",!0)]),e("div",ge,[w.value.length?(n(),l("div",he,[ye,e("ul",me,[(n(!0),l(z,null,Q(w.value,a=>(n(),l("li",{key:a,class:"flex justify-between items-center bg-white p-4 rounded shadow hover:shadow-lg transition-shadow"},[e("span",we,y(a.name),1),e("div",null,[e("button",{onClick:v=>M(a.name),class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded"}," 播放 ",8,be),e("button",{onClick:v=>F(a),class:"bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded"}," 参考 ",8,xe)])]))),128))]),D(e("audio",{ref_key:"audioPlayer",ref:b,controls:"",class:"w-full mt-5"},null,512),[[H,!1]])])):(n(),l("div",ke,$e))])])]))}});const De=X(Re,[["__scopeId","data-v-ce4f8eaa"]]);export{De as default};
