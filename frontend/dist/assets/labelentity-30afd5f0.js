import{d as fe,L as Q,g as _,y as he,h as me,r as $,$ as ye,o as c,b as d,f as r,a as s,F as q,e as j,p as R,A as M,C as B,t as D,i as h,D as L,G as we,w as m,j as C,c as be,O as ke,z as G,B as I,E as w}from"./index-f50d6d08.js";import{u as W,a as xe,_ as Ce}from"./navHeader.vue_vue_type_script_setup_true_lang-5f81fcc5.js";import{_ as $e,a as qe,b as Me}from"./functionDrawer.vue_vue_type_script_setup_true_lang-34bd2630.js";import{g as Ve,a as je,b as Se,s as Ae}from"./api-e233926e.js";import"./axios-a342f982.js";const Te={class:"left h-screen w-1/2 rounded"},Ue={class:"w-full h-full overflow-auto border-r-2 border-gray-300 rounded-sm"},Re=["msgId","onDblclick","innerHTML"],Be=["onUpdate:modelValue"],De={key:0,class:"w-6 h-6 mt-1"},Le={key:1,class:"w-6 h-6 mt-1"},Ne={class:"text-ellipsis overflow-hidden w-full text-center leading-4"},Ee={class:"text-sm leading-4"},He={class:"flex w-full h-12 grow"},ze={class:"right bg-white w-1/2"},Fe=s("div",{class:"text-center mb-2"},"点击任何按钮生成对应的对话 ",-1),Ge={class:"flex justify-between items-center flex-wrap w-4/5"},Ke=s("span",null,"prompt:",-1),Oe={key:0},Pe={key:1},Qe={class:"card-body p-6"},Ie={class:"card-title"},We=["onClick"],Je=["onClick"],Xe={key:2},Ye=["onMouseover","onMouseleave"],Ze={class:"input input-bordered w-32"},et=["onUpdate:modelValue"],tt={class:"input input-bordered w-32"},lt=["onUpdate:modelValue"],ot={class:"input input-bordered w-64 overflow-auto"},nt=["onUpdate:modelValue"],st=["onClick"],at=["onClick"],mt=fe({__name:"labelentity",setup(ut){const{currentQuestion:a,messages:e,function_result:it,message_tool_names:J,tools_data:N,multi_llm_results:E}=Q(W()),{selectedLLM:ct,sample_idx:b,selectedSample:S,usecache:rt,norepeat:X,currentPrompt:A}=Q(xe()),{AddHumanMsg:Y,AddGptMsg:Z,AddFunctionMsg:dt,AddObservationMsg:vt}=W(),T=_(-1);he(()=>a.value.question_type==="observation"||a.value.question_type==="function_call");const H=_(),ee=_(!1),K=_(),te=_([]),V=_(),z=_(!1);_(!1);const k=_(!1),le=_(!0),x=_([]);_(-1);function oe(){let l=window.getSelection().toString();if(l.trim()!==""){const n=l.trim();if(e.value[e.value.length-1].role==="gpt"){const u=e.value[e.value.length-1].content,y=`(${n}, 实体)`,p=`${u}
${y}`;e.value[e.value.length-1].content=p}else{const u=`(${n}, 实体)`;e.value.push({id:e.value[e.value.length-1].id+1,role:"gpt",content:u})}}}function ne(l){console.log("高亮规则回答:",l);const n=e.value[e.value.length-1].role;let o;n==="human"?o=e.value.length-1:o=e.value.length-2;let u=e.value[o].content;const y=l.subject,p=new RegExp(y,"g"),f=`<span style="background-color: red;">${y}</span>`;u=u.replace(p,f),e.value[o].display_content=u}function se(l){console.log("移除规则回答的高亮:",l);const n=e.value[e.value.length-1].role;let o;n==="human"?o=e.value.length-1:o=e.value.length-2,e.value[o].display_content=""}function U(l,n){let o="否";n==="yes"&&(o="是");const u=x.value[l];if(e.value[e.value.length-1].role==="gpt"){const p=e.value[e.value.length-1].content,g=`(${u.subject},${u.category}, ${o})`,f=`${p}
${g}`;e.value[e.value.length-1].content=f}else{const p=`(${u.subject},${u.category}, ${o})`;e.value.push({id:e.value[e.value.length-1].id+1,role:"gpt",content:p})}x.value.splice(l,1)}function O(){x.value=[];const l=e.value[e.value.length-1].content,n=l.content,o=l.keywords,u=l.category,y=l.keyword_regex;e.value[e.value.length-1].content=n;let p=[];for(let g in o){const f=o[g],F=u[g],t=y[g],v=f.split(",");for(let i of v){if(!p.includes(i))p.push(i);else continue;const ge={subject:i,category:F,regex:t,entity:"是"};x.value.push(ge)}}x.value.sort((g,f)=>g.subject.localeCompare(f.subject))}function ae(){e.value[e.value.length-1].role==="gpt"?e.value[e.value.length-1].content="无":e.value.push({id:e.value[e.value.length-1].id+1,role:"gpt",content:"无"})}function ue(){e.value=[],x.value=[],a.value.question="",a.value.question_id=-1,a.value.question_type="",k.value&&(b.value+=1),k.value=!1}function ie(l){e.value.push({id:e.value[e.value.length-1].id+1,role:"gpt",content:l}),z.value=!1,E.value=[]}function ce(l){const n=JSON.stringify(l);e.value.push({id:e.value[e.value.length-1].id+1,role:"function_call",content:n}),z.value=!1,E.value=[]}function re(){K.value.includes(S.value)&&(te.value.push(S.value),ee.value=!0)}async function de(){if(V.value||w.info("你还没有在管理界面设置Sample问题类型，请先进行设置后，在使用sample按钮"),k.value=!0,b.value<=V.value.length){const l=V.value[b.value];re(),e.value.length===0?(e.value.push({id:1,role:"human",content:l}),O()):e.value[e.value.length-1].role==="gpt"?(e.value.push({id:e.value[e.value.length-1].id+1,role:"human",content:l}),O()):w.warning("上一条消息不是gpt，或者不是第一条信息，无法添加human的问题")}else w.warning("没有更多的的样本了,请在管理中设置样本数据集和样本的起始序号")}async function ve(){const l=await Ae({messages:e.value,prompt:A.value,tools:J.value});console.log("数据的保存结果:",l),l.code===0?(w({message:"保存数据成功到后台",type:"info"}),e.value=[],a.value.question="",a.value.question_id=-1,a.value.question_type="",k.value&&(b.value+=1),k.value=!1):w({message:"保存数据失败，请检查后端日志",type:"error"})}function pe(l){if(l!==-1){console.log("要删除message:",l);let n=e.value.filter(o=>o.id!==l);e.value=n,k.value&&e.value.length===0&&(b.value+=1),k.value=!1}else w({message:"没有选中任何信息，请双击1条信息，然后按delete键删除",type:"info"})}function _e(l){e.value.forEach((n,o)=>{o===l&&(a.value.question_type=n.role,T.value=l)})}function P(){if(a.value.question_id===-1&&e.value.length===0)e.value.push({id:1,role:"human",content:a.value.question});else{if(!a.value.question_type){w({message:"还没有选择当前消息的类型，请右边点击按钮选择类型",type:"info"});return}if(!a.value.question){w({message:"你好像还么有输入任何內",type:"info"});return}const l=e.value[e.value.length-1].role;if(a.value.question_type===l){w({message:"不能连续2条都是同1个角色的消息",type:"info"});return}e.value.push({id:e.value[e.value.length-1].id+1,role:a.value.question_type,content:a.value.question})}a.value.question="",a.value.question_id=-1,a.value.question_type=""}return me(async()=>{const l=await Ve();H.value=l.data,console.log("prompts:",H.value);const n=await je();N.value=n.data,console.log("tools_data:",N.value),K.value=Object.keys(N.value);const o=await Se({keyword:S.value,norepeat:X.value});console.log("获取到的采样数据：",o),o.data.forEach(u=>{u.prompt===S.value&&(V.value=u.questions)}),console.log(V.value),b.value=+b.value}),(l,n)=>{const o=$("el-button"),u=$("el-input"),y=$("el-option"),p=$("el-select"),g=$("el-row"),f=$("el-divider"),F=ye("autogrow");return c(),d(q,null,[r(Ce),s("main",{class:"w-screen flex mx-auto my-0 p-2",tabindex:"0",onKeydown:[n[3]||(n[3]=L(t=>U(0,"yes"),["1"])),n[4]||(n[4]=L(t=>U(0,"no"),["2"])),L(oe,["q"])]},[s("div",Te,[s("div",Ue,[(c(!0),d(q,null,j(h(e),(t,v)=>(c(),d("div",{class:"leading-6 flex justify-between content-center relative grow",key:t.id},[s("div",{class:R(["w-full flex justify-between my-1 py-1 rounded-sm",t.role==="human"?"flex-row bg-green-200":"flex-row-reverse bg-blue-200"])},[s("div",{class:R(["font-medium flex-grow",{"bg-red-200":T.value===v}])},[T.value!==v?(c(),d("div",{key:0,class:R(["mx-2 whitespace-pre-wrap",t.role==="human"?"":"mr-8"]),msgId:t.id,onDblclick:i=>_e(v),innerHTML:t.display_content?t.display_content:t.content},null,42,Re)):M((c(),d("textarea",{key:1,"onUpdate:modelValue":i=>t.content=i,onBlur:n[0]||(n[0]=i=>T.value=-1),class:"w-full"},null,40,Be)),[[B,t.content],[F]])],2),s("div",{class:R(["relative w-24 shrink-0 flex items-center box-border",t.role==="human"?"flex-row-reverse mr-8":"flex-row"])},[t.role==="human"?(c(),d("div",De,[r($e)])):(c(),d("div",Le,[r(qe)])),s("div",Ne,[s("span",Ee,D(t.role),1)])],2)],2),r(o,{size:"small",class:"hover:scale-110 absolute right-0 top-3",onClick:i=>pe(t.id),type:"danger",icon:"Delete",circle:""},null,8,["onClick"])]))),128))]),s("div",He,[r(u,{modelValue:h(a).question,"onUpdate:modelValue":n[1]||(n[1]=t=>h(a).question=t),autosize:"",type:"textarea",placeholder:"请输入或双击对话修改,Shift+enter提交",onKeyup:L(we(P,["shift"]),["enter"])},null,8,["modelValue","onKeyup"]),r(o,{type:"success",onClick:P,title:"shift+enter提交"},{default:m(()=>[C("新增")]),_:1})])]),s("div",ze,[Fe,s("div",Ge,[s("div",null,[Ke,r(p,{modelValue:h(A),"onUpdate:modelValue":n[2]||(n[2]=t=>ke(A)?A.value=t:null),placeholder:"Select",style:{width:"100px"}},{default:m(()=>[(c(!0),d(q,null,j(H.value,(t,v)=>(c(),be(y,{key:t.name,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),r(g,{class:"w-full"},{default:m(()=>[r(o,{type:h(a).question_type==="human"?"primary":"success",round:"",onClick:h(Y)},{default:m(()=>[C("Human")]),_:1},8,["type","onClick"]),r(o,{type:h(a).question_type==="gpt"?"primary":"success",round:"",onClick:h(Z)},{default:m(()=>[C("gpt")]),_:1},8,["type","onClick"])]),_:1}),r(g,null,{default:m(()=>[r(o,{type:"danger",round:"",onClick:de},{default:m(()=>[C("sample")]),_:1}),r(o,{type:"warning",round:"",onClick:ue},{default:m(()=>[C("clear")]),_:1}),r(o,{type:"danger",round:"",onClick:ve},{default:m(()=>[C("save")]),_:1}),r(o,{type:"warning",round:"",onClick:ae},{default:m(()=>[C("none")]),_:1})]),_:1})]),h(a).question_type==="function_call"?(c(),d("div",Oe,[r(f),r(Me)])):G("",!0),z.value?(c(),d("div",Pe,[r(f),s("div",null,[(c(!0),d(q,null,j(h(E),t=>(c(),d("div",{class:"card w-full bg-base-300 shadow-xl mb-5",key:t.llm},[s("div",Qe,[s("h3",Ie,D(t.llm),1),M(s("button",{class:"btn btn-outline btn-success h-full",onClick:v=>ie(t.response.content)},D(t.response.content),9,We),[[I,t.response.tool_calls.length===0]]),M(s("div",null,[(c(!0),d(q,null,j(t.response.tool_calls,v=>(c(),d("button",{class:"btn btn-outline btn-success h-full",onClick:i=>ce(v)},D(v),9,Je))),256))],512),[[I,t.response.tool_calls.length!==0]])])]))),128))])])):G("",!0),le.value?(c(),d("div",Xe,[(c(!0),d(q,null,j(x.value,(t,v)=>(c(),d("div",{class:"flex items-center gap-6 flex-row mt-4 hover:border hover:border-pink-700",onMouseover:i=>ne(t),onMouseleave:i=>se(t)},[s("label",Ze,[M(s("input",{type:"text",class:"grow",placeholder:"主体","onUpdate:modelValue":i=>t.subject=i},null,8,et),[[B,t.subject]])]),s("label",tt,[M(s("input",{type:"text",class:"grow",placeholder:"类别","onUpdate:modelValue":i=>t.category=i},null,8,lt),[[B,t.category]])]),s("label",ot,[M(s("input",{type:"text",class:"grow",placeholder:"规则","onUpdate:modelValue":i=>t.regex=i},null,8,nt),[[B,t.regex]])]),s("button",{class:"btn btn-success",onClick:i=>U(v,"yes")},"是",8,st),s("button",{class:"btn btn-warning",onClick:i=>U(v,"no")},"否",8,at)],40,Ye))),256))])):G("",!0)])],32)],64)}}});export{mt as default};
