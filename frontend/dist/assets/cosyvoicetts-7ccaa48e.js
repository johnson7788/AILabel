import{_ as P,g as a,h as U,o as u,b as i,a as r,F as D,e as L,A as R,C as B,t as b,j as E,z as h,E as d,p as N,q as V,s as A}from"./index-f50d6d08.js";import{a as x}from"./axios-a342f982.js";const w=p=>(V("data-v-de139295"),p=p(),A(),p),j={class:"flex flex-col items-center p-4"},z=w(()=>r("label",{class:"mb-2"},"选择说话人 ID:",-1)),F={class:"flex flex-wrap gap-2 mb-4"},M=["onClick"],q=w(()=>r("label",{for:"ttsText",class:"mb-2"},"TTS 文本:",-1)),O=["disabled"],Y=["src"],G=["href"],H={__name:"cosyvoicetts",setup(p){const s="https://ai.minitool.fun:15302",_=a(""),v=a(!1),l=a(""),f=a(0),g=a(0),n=a(null),y=a(["中文女"]),c=a(),T=e=>{c.value=y.value[e]},k=async()=>{if(!_.value||!c.value){alert("请输入 TTS 文本和说话人 ID");return}const e=`${s}/api/inference_sft?tts_text=${encodeURIComponent(_.value)}&spk_id=${encodeURIComponent(c.value)}`;v.value=!0,l.value="";try{const t=await fetch(e);if(!t.ok)throw new Error("网络响应错误: "+t.status);const o=await t.blob();l.value=URL.createObjectURL(o),f.value=0,g.value=0}catch(t){console.error("请求音频流失败:",t)}finally{v.value=!1}},$=()=>{n.value&&(g.value=n.value.duration)},S=()=>{n.value&&(f.value=n.value.currentTime)};async function I(){try{(await x.get(`${s}/ping`)).data==="Pong"?d({title:"连接服务器成功",message:"开始获取数据",type:"success"}):d({title:"服务器没有返回Pong",message:`请联系管理员检查服务器地址${s}`,type:"error"})}catch(e){d({title:"连接服务器失败",message:`请检查网络连接${s},${e}`,type:"error"})}}async function C(){try{const e=await x.get(`${s}/api/get_speak_id`);if(console.log("获取speak_id",e),e.status===200&&e.data.code===0)return e.data.data;d({title:"服务器没有返回状态200和code为0",message:`请联系管理员检查服务器API是否正常${s}`,type:"error"})}catch(e){d({title:"连接服务器失败",message:`请检查网络连接${s},${e}`,type:"error"})}}return U(async()=>{await I(),y.value=await C()}),(e,t)=>(u(),i("div",j,[z,r("div",F,[(u(!0),i(D,null,L(y.value,(o,m)=>(u(),i("button",{key:m,onClick:J=>T(m),class:N([{"bg-blue-200 text-gray-700 border border-blue-300":c.value===o,"bg-gray-100 text-gray-500 border border-gray-300":c.value!==o},"px-4 py-2 rounded-full shadow-sm cursor-pointer"])},[r("span",null,b(o),1)],10,M))),128))]),q,R(r("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>_.value=o),type:"text",id:"ttsText",placeholder:"请输入 TTS 文本",class:"mb-4 p-2 border border-gray-300 rounded w-4/5"},null,512),[[B,_.value]]),r("button",{onClick:k,class:"bg-blue-500 text-white py-2 px-4 rounded",disabled:v.value},b(v.value?"加载中...":"生成 TTS 音频"),9,O),l.value?(u(),i("audio",{key:0,ref_key:"audioPlayer",ref:n,onLoadedmetadata:$,onTimeupdate:S,controls:""},[r("source",{src:l.value,type:"audio/wav"},null,8,Y),E(" Your browser does not support the audio tag. ")],544)):h("",!0),l.value?(u(),i("a",{key:1,href:l.value,download:"tts_audio.wav",class:"mt-4 bg-green-500 text-white py-2 px-4 rounded"}," 下载音频 ",8,G)):h("",!0)]))}},W=P(H,[["__scopeId","data-v-de139295"]]);export{W as default};
