import{d as G,g as a,h as W,o as n,b as l,a as e,A,C as S,z as m,t as y,j as F,F as Q,e as Y,E as r,Q as H,B as J,q as K,s as X,_ as Z}from"./index-f50d6d08.js";import{a as w}from"./axios-a342f982.js";import{W as ee}from"./index-4b1aff9b.js";const c=_=>(K("data-v-d4df087a"),_=_(),X(),_),te={class:"container mx-auto py-10"},oe={class:"flex flex-col sm:flex-row"},se={class:"bg-white p-8 rounded-lg shadow-md w-full sm:w-1/2 sm:mr-4 mb-4 sm:mb-0"},ae=c(()=>e("p",{class:"text-lg my-2"},"根据提供的声音克隆，请输入TTS文本，请上传或者从右侧选择1个示例声音，并且要输入声音中的文字",-1)),ne=c(()=>e("label",{for:"audio-text",class:"mb-2"},"声音对应文本:",-1)),le={key:0},re=c(()=>e("label",{for:"audio-file",class:"block text-sm font-medium text-gray-700 mb-2"},"上传参考或录制声音文件",-1)),ie={class:"flex justify-between items-center h-16 mb-8 space-x-4"},ce={key:0,class:"w-2/3"},ue=c(()=>e("div",{class:"border h-full"},null,-1)),de={key:1,class:"w-1/3"},pe={key:1,class:"flex justify-between items-center bg-white p-4 rounded shadow hover:shadow-lg transition-shadow"},ve={class:"text-green-700"},fe={class:"mb-4"},_e=c(()=>e("label",{for:"ttsText",class:"block text-sm font-medium text-gray-700 mb-2"},"TTS内容",-1)),he=["src"],ge=["href"],me={class:"w-full sm:w-1/2"},ye={key:0,class:"space-y-4"},we=c(()=>e("h2",{class:"text-2xl font-bold text-gray-800"},"选择或者试听文件",-1)),be={class:"grid grid-cols-1 gap-4"},xe={class:"text-gray-700"},ke=["onClick"],Ce=["onClick"],$e={key:1,class:"text-center py-5"},Re=c(()=>e("p",{class:"text-gray-500"},"没有找到Audio文件，请检查服务器是否正常",-1)),Ue=[Re],Te=G({__name:"cosyvoiceclone",setup(_){const i="https://ai.minitool.fun:15302",b=a([]),x=a(null),I=a(null),u=a(),k=a("你好啊，我是AI机器人"),d=a(null),p=a(),h=a(""),g=a(!1),v=a(null),C=a(!0),$=a(!0),R=a(!0),U=a(!1);function P(t){h.value=t.srt,p.value=t.name,C.value=!1}const j=t=>{$.value=!1;const o=t.target;o.files&&(d.value=o.files[0]),r({title:"上传完成",message:"可以点击克隆了",type:"success"})},L=async()=>{R.value=!1;try{const t=H([]),o=await navigator.mediaDevices.getUserMedia({audio:!0});v.value=new MediaRecorder(o),v.value.ondataavailable=s=>{t.push(s.data)},v.value.onstop=async()=>{const f=await new Blob(t).arrayBuffer(),T=await new AudioContext().decodeAudioData(f),D=[];for(let B=0;B<T.numberOfChannels;B++)D.push(T.getChannelData(B));const O=await ee.encode({sampleRate:T.sampleRate,channelData:D}),q=new Blob([O],{type:"audio/wav"});d.value=new File([q],"recorded_audio.wav",{type:"audio/wav"})},v.value.start(),g.value=!0,r({title:"录制完成",message:"可以点击克隆了",type:"success"})}catch(t){console.error("不能获取麦克风:",t)}},E=()=>{v.value&&(v.value.stop(),g.value=!1)},V=async()=>{if(!d.value&&!p.value){alert("请首先选择参考音频或者上传音频文件或者录音");return}U.value=!0;let t=`tts_text=${encodeURIComponent(k.value)}&prompt_text=${encodeURIComponent(h.value)}`;p.value&&(t+=`&wav_path=${encodeURIComponent(p.value)}`);try{if(d.value){const o=new FormData;o.append("prompt_wav",d.value);const f=await(await w.post(`${i}/api/inference_zero_shot_upload?${t}`,o,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"})).data;u.value=URL.createObjectURL(f),d.value=null}else{const s=await(await w.get(`${i}/api/inference_zero_shot_wav_path?${t}`,{responseType:"blob"})).data;u.value=URL.createObjectURL(s),p.value=""}}catch(o){console.error("推理失败，请检查服务器:",o),alert(`推理失败，请检查服务器,${o}`)}U.value=!1,R.value=!0,$.value=!0,C.value=!0},M=async()=>{try{const t=await w.get(`${i}/api/get_reference_audio`);t.data.code===0?(b.value=t.data.data,r({title:"音频文件获取成功",message:"音频文件已成功获取！",type:"success"})):r({title:"获取音频文件错误",message:"获取音频文件失败，请重试。",type:"error"})}catch(t){r({title:"获取音频文件错误",message:"获取音频文件失败，请重试。",type:"error"}),console.error("Error fetching audio files:",t)}},N=t=>{const o=`${i}/api/audio/${t}`;x.value.src=o,x.value.play()};async function z(){try{(await w.get(`${i}/ping`)).data==="Pong"?r({title:"连接服务器成功",message:"开始获取数据",type:"success"}):r({title:"服务器没有返回Pong",message:`请联系管理员检查服务器地址${i}`,type:"error"})}catch(t){r({title:"连接服务器失败",message:`请检查网络连接${i},${t}`,type:"error"})}}return W(async()=>{await z(),await M()}),(t,o)=>(n(),l("div",te,[e("div",oe,[e("div",se,[ae,ne,A(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>h.value=s),type:"text",id:"audio-text",placeholder:"请输入声音对应的文本",class:"mb-4 p-2 border border-gray-300 rounded w-full sm:w-4/5"},null,512),[[S,h.value]]),C.value?(n(),l("div",le,[re,e("div",ie,[R.value?(n(),l("div",ce,[e("input",{type:"file",id:"audio-file",accept:"audio/*",onChange:j,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,32)])):m("",!0),ue,$.value?(n(),l("div",de,[e("button",{onClick:o[1]||(o[1]=s=>g.value?E():L()),class:"w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"},y(g.value?"停止录制":"开始录制"),1)])):m("",!0)])])):(n(),l("div",pe,[F(" 声音: "),e("span",ve,y(p.value),1)])),e("div",fe,[_e,A(e("textarea",{id:"ttsText","onUpdate:modelValue":o[2]||(o[2]=s=>k.value=s),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入TTS文本"},null,512),[[S,k.value]])]),e("div",null,[e("button",{onClick:V,class:"w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"},y(U.value?"加载中...":"克隆音频"),1)]),u.value?(n(),l("audio",{key:2,ref_key:"audioGeneratePlayer",ref:I,controls:"",class:"my-6"},[e("source",{src:u.value,type:"audio/wav"},null,8,he),F(" Your browser does not support the audio tag. ")],512)):m("",!0),u.value?(n(),l("a",{key:3,href:u.value,download:"tts_audio.wav",class:"mt-4 bg-green-500 text-white py-2 px-4 rounded"}," 下载音频 ",8,ge)):m("",!0)]),e("div",me,[b.value.length?(n(),l("div",ye,[we,e("ul",be,[(n(!0),l(Q,null,Y(b.value,s=>(n(),l("li",{key:s,class:"flex justify-between items-center bg-white p-4 rounded shadow hover:shadow-lg transition-shadow"},[e("span",xe,y(s.name),1),e("div",null,[e("button",{onClick:f=>N(s.name),class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded"}," 播放 ",8,ke),e("button",{onClick:f=>P(s),class:"bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded"}," 参考 ",8,Ce)])]))),128))]),A(e("audio",{ref_key:"audioPlayer",ref:x,controls:"",class:"w-full mt-5"},null,512),[[J,!1]])])):(n(),l("div",$e,Ue))])])]))}});const Fe=Z(Te,[["__scopeId","data-v-d4df087a"]]);export{Fe as default};
