async function C(r,t){const n=r.getReader();let e;for(;!(e=await n.read()).done;)t(e.value)}function I(r){let t,n,e,o=!1;return function(s){t===void 0?(t=s,n=0,e=-1):t=P(t,s);const i=t.length;let a=0;for(;n<i;){o&&(t[n]===10&&(a=++n),o=!1);let c=-1;for(;n<i&&c===-1;++n)switch(t[n]){case 58:e===-1&&(e=n-a);break;case 13:o=!0;case 10:c=n;break}if(c===-1)break;r(t.subarray(a,c),e),a=n,e=-1}a===i?t=void 0:a!==0&&(t=t.subarray(a),n-=a)}}function L(r,t,n){let e=T();const o=new TextDecoder;return function(s,i){if(s.length===0)n==null||n(e),e=T();else if(i>0){const a=o.decode(s.subarray(0,i)),c=i+(s[i+1]===32?2:1),d=o.decode(s.subarray(c));switch(a){case"data":e.data=e.data?e.data+`
`+d:d;break;case"event":e.event=d;break;case"id":r(e.id=d);break;case"retry":const u=parseInt(d,10);isNaN(u)||t(e.retry=u);break}}}}function P(r,t){const n=new Uint8Array(r.length+t.length);return n.set(r),n.set(t,r.length),n}function T(){return{data:"",event:"",id:"",retry:void 0}}var _=globalThis&&globalThis.__rest||function(r,t){var n={};for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&t.indexOf(e)<0&&(n[e]=r[e]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,e=Object.getOwnPropertySymbols(r);o<e.length;o++)t.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(r,e[o])&&(n[e[o]]=r[e[o]]);return n};const m="text/event-stream",A=1e3,k="last-event-id";function N(r,t){var{signal:n,headers:e,onopen:o,onmessage:y,onclose:s,onerror:i,openWhenHidden:a,fetch:c}=t,d=_(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((u,j)=>{const f=Object.assign({},e);f.accept||(f.accept=m);let v;function O(){v.abort(),document.hidden||g()}a||document.addEventListener("visibilitychange",O);let E=A,h=0;function p(){document.removeEventListener("visibilitychange",O),window.clearTimeout(h),v.abort()}n==null||n.addEventListener("abort",()=>{p(),u()});const x=c??window.fetch,S=o??H;async function g(){var w;v=new AbortController;try{const b=await x(r,Object.assign(Object.assign({},d),{headers:f,signal:v.signal}));await S(b),await C(b.body,I(L(l=>{l?f[k]=l:delete f[k]},l=>{E=l},y))),s==null||s(),p(),u()}catch(b){if(!v.signal.aborted)try{const l=(w=i==null?void 0:i(b))!==null&&w!==void 0?w:E;window.clearTimeout(h),h=window.setTimeout(g,l)}catch(l){p(),j(l)}}}g()})}function H(r){const t=r.headers.get("content-type");if(!(t!=null&&t.startsWith(m)))throw new Error(`Expected content-type to be ${m}, Actual: ${t}`)}export{N as f};
