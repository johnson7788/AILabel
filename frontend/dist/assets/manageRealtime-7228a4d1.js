import{d as x,o as i,b as c,U as N,g as l,f as D,a as t,A as y,J as F,t as g,C as M,z as R,j as U,F as q,e as B,E as n}from"./index-f50d6d08.js";import{a as f}from"./axios-a342f982.js";import{h as p}from"./utils-ac468565.js";import"./store-1a8c456b.js";const E={class:"w-1/5 h-screen"},I=N('<ul class="menu bg-base-200 rounded-box w-56"><li><a href="/mind/manage/realtime">实时</a></li><li><details open><summary>标注</summary><ul><li><a>Submenu 1</a></li><li><a>Submenu 2</a></li><li><details open><summary>Parent</summary><ul><li><a>Submenu 1</a></li><li><a>Submenu 2</a></li></ul></details></li></ul></details></li><li><a>训练</a></li></ul>',1),L=[I],T=x({__name:"manage",setup(b){return(d,u)=>(i(),c("div",E,L))}}),j={class:"flex"},z={class:"w-4/5 mt-6"},A={class:"flex flex-col w-full"},H={class:"flex flex-row"},J={class:"pl-1 pt-2 mr-10"},G=t("span",{class:"font-medium mr-2"},"状态: ",-1),K={key:0,class:"text-red-500"},Q={key:1,class:"text-green-500"},W={class:"form-control w-36"},X={class:"label"},Y=t("span",{class:"font-medium cursor-pointer"},"开始接收:",-1),Z={class:"flex flex-col w-full mt-4 gap-4"},ee={class:"flex flex-row w-full"},te=t("p",{class:"mr-2"},"服务器SOP消息:",-1),se={class:"mx-auto"},ae={key:0,class:"loading loading-spinner"},ne={class:"flex flex-row w-full"},oe={class:"mr-2 text-blue-400"},le={class:"mr-2"},de=x({__name:"manageRealtime",setup(b){const d="https://ai.minitool.fun:15554",u=l("checked"),w=l(!1),o=l(),m=l(),r=l([]),v=l(!1),_=l(null);async function S(){v.value=!0;const e=await f.post(`${d}/mind/train`,{train_data:[[m.value,o.value]],output_dir:"mind",continue_train:!0},{headers:p});if(console.log("训练一条数据的结果是",e),e.data.code==0){const s=e.data.data;n({title:"训练成功",message:s,type:"success"}),o.value="",m.value="",r.value=[]}else n({title:"训练失败",message:e.data.msg,type:"error"});v.value=!1}async function h(e){const s=await f.post(`${d}/mind/turn_on_off_realtime`,{open:e},{headers:p});if(s.data.code==0){const a=s.data.data;n({title:"开关成功",message:a,type:"success"})}else n({title:"开关失败，检查网络链接",message:s.data.msg,type:"error"})}async function k(){const e=await f.post(`${d}/mind/to_front_data`,{headers:p});if(e.data.code==0){const s=e.data.data;return n({title:"获取到服务器的最新数据成功",message:s,type:"success"}),s}return null}async function O(e){(await f.post(`${d}/mind/from_front_data`,{front_data:e},{headers:p})).data.code==0&&n({title:"发送数据给服务器成功",message:e,type:"success"})}async function P(){u.value?(await h(!0),u.value=!0,n({title:"已开启监听",message:"已通知服务器可以传输数据",type:"success"}),_.value=setInterval(async()=>{const e=await k();e&&V(e)},1e3)):(await h(!1),u.value=!1,n({title:"已关闭监听",message:"不在通知服务端发送数据到前端",type:"success"}),_.value&&(clearInterval(_.value),_.value=null))}const V=e=>{if(console.log("收到服务器发送活来的数据:",e),e.msg)n({title:"收到服务器消息",message:e.msg,type:"success"});else if(e.question)n({title:"收到服务器SOP",message:"收到服务器SOP",type:"success"}),m.value=e.question,o.value=e.sop,r.value=[];else if(e.intermidiates){const s=e.intermidiates;for(const a of s)a.thought&&r.value.push({name:"thought",content:a.thought}),a.observation&&r.value.push({name:"observation",content:a.observation}),a.output&&r.value.push({name:"output",content:a.output});n({title:"收到服务器中间过程和结果",message:"收到服务器中间过程和结果",type:"success"})}else o.value=e.msg},$=async()=>{await O({sop:o.value}),n({title:"发送消息SOP到服务器",message:"发送消息SOP到服务器",type:"success"})};return(e,s)=>(i(),c("div",j,[D(T),t("div",z,[t("div",A,[t("div",H,[t("div",J,[G,w.value?(i(),c("span",Q,"已连接")):(i(),c("span",K,"未连接"))]),t("div",W,[t("label",X,[Y,y(t("input",{type:"checkbox",class:"toggle toggle-primary","onUpdate:modelValue":s[0]||(s[0]=a=>u.value=a),onChange:P},null,544),[[F,u.value]])])])]),t("div",Z,[t("div",null,g(m.value),1),t("div",ee,[te,y(t("textarea",{class:"textarea textarea-primary min-h-52 w-full mr-6",placeholder:"修改服务器传过来SOP，修改后发送回去","onUpdate:modelValue":s[1]||(s[1]=a=>o.value=a)},null,512),[[M,o.value]])]),t("div",se,[t("button",{class:"btn btn-outline btn-success mr-10",onClick:$},"发送"),t("button",{class:"btn btn-outline btn-warning",onClick:S},[v.value?(i(),c("span",ae)):R("",!0),U(" 学习")])]),(i(!0),c(q,null,B(r.value,(a,C)=>(i(),c("div",{key:C},[t("div",ne,[t("div",oe,g(a.name),1),t("div",le,g(a.content),1)])]))),128))])])])]))}});export{de as default};
