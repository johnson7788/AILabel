import{a as H}from"./axios-a342f982.js";import{d as _,g as o,y as D,k as $,h as ee,T as te,o as M,b as B,a as l,t as se,z as ae,K as ne,q as oe,s as ce,_ as le}from"./index-f50d6d08.js";const ie="/assets/logo-f0392dc0.png",re="/assets/AIIcon1-628cefe9.png",ue="/assets/voice-9a106b6c.gif",de="/assets/yuyin-d43871c6.png",pe="data:image/png;base64,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",ve="data:image/png;base64,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",F=y=>(oe("data-v-abf27c18"),y=y(),ce(),y),fe={class:"min-h-screen"},ge=F(()=>l("div",{className:"screenerTop"},[l("img",{width:"154",style:{"padding-top":"10px"},src:ie,alt:""})],-1)),Ae={className:"studyMain"},he={className:"screener"},ye={className:"screenerHead"},me={className:"screenerOutline"},we=F(()=>l("div",{className:"ai-avatar aiAvatar"},[l("img",{src:re,alt:""})],-1)),ke={key:0},Se={class:"ai-avatar",style:{"margin-top":"20px"}},Ve=["src"],Ie=["src","alt"],Ne=_({__name:"index",setup(y){const m="https://ai.minitool.fun:15401",E=m.replace("https://","wss://").replace("http://","ws://"),x=o("property management service"),d=o(!1),A=o(!1),w=o(!1),C=o(!0),f=o([]);f.value.push({type:"system",content:"欢迎使用实时访谈系统,点击Connect开始。"});const S=o(null),V=o(null),p=o([]),Q=o(Array(20).fill(5));let u=null,h=null,v=null,k=null;const G=o("dan"),R=o(["amuch","dan"]),i=o(null);let g=null;const I=[];let N=!1;const Z=D(()=>d.value?ue:de),T=D(()=>d.value?pe:ve),b=async()=>{console.log("开始录音");try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});u=new window.AudioContext,h=u.createMediaStreamSource(e),v=u.createAnalyser(),v.fftSize=64,k=new Uint8Array(v.frequencyBinCount),g=u.createScriptProcessor(4096,1,1),h.connect(v),h.connect(g),g.connect(u.destination),g.onaudioprocess=W,A.value=!0,U()}catch(e){console.error("Error accessing microphone:",e),p.value.push({type:"system",content:"访问麦克风出错。请检查权限设置。"})}},q=e=>{const s=new ArrayBuffer(e.length*2),t=new DataView(s);for(let n=0;n<e.length;n++){const c=Math.max(-1,Math.min(1,e[n]));t.setInt16(n*2,c<0?c*32768:c*32767,!0)}return s},z=e=>{const s=q(e),t=new Uint8Array(s);let n="";const c=32768;for(let a=0;a<t.length;a+=c){const r=t.subarray(a,a+c);n+=String.fromCharCode.apply(null,Array.from(r))}return btoa(n)},W=e=>{const s=e.inputBuffer.getChannelData(0),t=z(s);O(t)},O=e=>{if(i.value&&i.value.readyState===WebSocket.OPEN){const s={event:"media",media:{payload:e}};i.value.send(JSON.stringify(s)),p.value.push({type:"sent",content:"发送了音频数据到后台"})}},J=()=>{h&&v&&(console.log("停止录音"),h.disconnect(),v.disconnect(),g&&(g.disconnect(),g.onaudioprocess=null),A.value=!1)},Y=()=>{var e;d.value?((e=i.value)==null||e.close(),d.value=!1,A.value=!1,J()):L()},L=()=>{f.value=[],p.value=[];const e="chikka";try{i.value=new WebSocket(`${E}/ws/voice-stream/${e}?voice=${G.value}`),i.value.onerror=()=>{console.error("WebSocket连接失败，服务器可能未启动或网络有问题。")}}catch(s){console.error(`创建WebSocket时发生错误，后台服务器没启动：${s.message}`)}i.value.onopen=()=>{d.value=!0,p.value.push({type:"system",content:"连接后台成功"}),b()},i.value.onmessage=s=>{var n,c;const t=JSON.parse(s.data);if(t.event==="media")p.value.push({type:"received",content:"收到了后台语音数据"}),I.push(t.media.payload),N||X();else if(t.event==="message"){console.log(t);let a=t.response.type;if(t.response.type==="response.audio.delta"?a=a+": 音频子节长度"+t.response.delta.length:a=a+": "+t.response.delta,p.value.push({type:"system",content:a}),((n=t.response)==null?void 0:n.type)==="response.audio_transcript.delta"){const r=t.response.delta;A.value&&(J(),A.value=!1,p.value.push({type:"system",content:"已停止录音，后台正在处理数据。"})),!w.value||f.value.length===0?(w.value=!0,f.value.push({type:"sent",content:"用户声音消息..."}),f.value.push({type:"received",content:r})):f.value[f.value.length-1].content+=r}((c=t.response)==null?void 0:c.type)==="response.audio_transcript.done"&&(C.value=!0)}j()},i.value.onclose=()=>{d.value=!1,p.value.push({type:"system",content:"Disconnected from server"})}},U=()=>{if(v&&k){v.getByteFrequencyData(k);for(let e=0;e<Q.value.length;e++)Q.value[e]=(k[e]||0)/2;A.value&&requestAnimationFrame(U)}},X=()=>{if(I.length>0){const e=I.shift();e&&(K(e,()=>{N=!1,X()}),N=!0)}else w.value=!1};$([w,C],([e,s])=>{!e&&s&&b()});const K=(e,s)=>{const t=Uint8Array.from(atob(e),r=>r.charCodeAt(0)),n=u.createBuffer(1,t.length/2,44100),c=new Int16Array(t.buffer);for(let r=0;r<c.length;r++)n.getChannelData(0)[r]=c[r]/32768;const a=u.createBufferSource();a.buffer=n,a.connect(u.destination),a.playbackRate.value=.6,a.onended=s,a.start()},j=async()=>{await ne(),V.value&&(V.value.scrollTop=V.value.scrollHeight),S.value&&(S.value.scrollTop=S.value.scrollHeight)};async function P(){try{const e=await H.get(`${m}/api/voice`);e.data.length>0?R.value=e.data:console.log(`请联系管理员检查服务器地址${m}`)}catch(e){console.log(`请检查网络连接${m},${e}`)}}return ee(async()=>{await P()}),te(()=>{i.value&&i.value.close(),u&&u.close()}),(e,s)=>(M(),B("div",fe,[ge,l("div",Ae,[l("div",he,[l("div",ye," 测试服务器示例: "+se(x.value),1),l("div",me,[we,d.value?(M(),B("div",ke)):ae("",!0),l("div",Se,[l("img",{width:"60%",src:Z.value,alt:""},null,8,Ve)]),l("div",{class:"ai-avatar startBtn",style:{"margin-top":"20px",cursor:"pointer"},onClick:Y},[l("img",{width:"50",src:T.value,alt:d.value?"暂停":"开始"},null,8,Ie)])])])])]))}});const be=le(Ne,[["__scopeId","data-v-abf27c18"]]);export{be as default};
