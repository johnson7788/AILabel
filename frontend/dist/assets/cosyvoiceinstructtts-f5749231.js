import{_ as z,g as l,h as F,o,b as a,a as t,F as m,e as f,A as C,C as S,t as b,j as M,z as U,E as i,p as q,q as O,s as Y}from"./index-f50d6d08.js";import{a as T}from"./axios-a342f982.js";const d=x=>(O("data-v-13c2c560"),x=x(),Y(),x),G={class:"flex flex-col items-center p-4"},H=d(()=>t("label",{class:"mb-2"},"选择说话人 ID:",-1)),J={class:"flex flex-wrap gap-2 mb-4"},K=["onClick"],Q=d(()=>t("label",{for:"ttsText",class:"mb-2"},"输入特色指令",-1)),W=d(()=>t("label",{for:"ttsText",class:"mb-2"},"TTS 文本:",-1)),X=["disabled"],Z=["src"],ee=["href"],te={class:"bg-white shadow-lg rounded-lg p-6"},se=d(()=>t("h1",{class:"text-3xl font-bold mb-6 text-center text-indigo-600"},"示例特色指令(后端需要使用对应的Instruct模型)",-1)),oe={class:"text-2xl font-semibold mb-4 text-indigo-800"},ae={class:"grid grid-cols-2 gap-4"},re=d(()=>t("h3",{class:"text-xl font-medium mb-2 text-indigo-700"},"Instruct",-1)),ne={class:"space-y-2"},le=["onClick"],ce=d(()=>t("h3",{class:"text-xl font-medium mb-2 text-indigo-700"},"TTS Text",-1)),ie={class:"space-y-2"},ue=["onClick"],de={__name:"cosyvoiceinstructtts",setup(x){const r="https://ai.minitool.fun:15302",p=l(""),_=l(""),y=l(!1),u=l(""),k=l(0),$=l(0),v=l(null),w=l(["中文女"]),g=l(),I=l({});function P(e){_.value=e}function R(e){p.value=e}const D=e=>{g.value=w.value[e]},L=async()=>{if(!p.value||!g.value||!_.value){alert("请输入 TTS 文本和说话人 ID和特色指令");return}const e=`${r}/api/inference_instruct?tts_text=${encodeURIComponent(p.value)}&spk_id=${encodeURIComponent(g.value)}&instruct_text=${encodeURIComponent(_.value)}`;y.value=!0,u.value="";try{const n=await fetch(e);if(!n.ok)throw new Error("网络响应错误: "+n.status);const s=await n.blob();u.value=URL.createObjectURL(s),k.value=0,$.value=0}catch(n){console.error("请求音频流失败:",n)}finally{y.value=!1}},V=()=>{v.value&&($.value=v.value.duration)},A=()=>{v.value&&(k.value=v.value.currentTime)};async function B(){try{(await T.get(`${r}/ping`)).data==="Pong"?i({title:"连接服务器成功",message:"开始获取数据",type:"success"}):i({title:"服务器没有返回Pong",message:`请联系管理员检查服务器地址${r}`,type:"error"})}catch(e){i({title:"连接服务器失败",message:`请检查网络连接${r},${e}`,type:"error"})}}async function E(){try{const e=await T.get(`${r}/api/get_speak_id`);if(console.log("获取speak_id",e),e.status===200&&e.data.code===0)return e.data.data;i({title:"服务器没有返回状态200和code为0",message:`请联系管理员检查服务器API是否正常${r}`,type:"error"})}catch(e){i({title:"连接服务器失败",message:`请检查网络连接${r},${e}`,type:"error"})}}async function N(){try{const e=await T.get(`${r}/api/get_example_instructs`);if(console.log("获取获取示例特色指令",e),e.status===200&&e.data.code===0)return e.data.data;i({title:"服务器没有返回状态200和code为0",message:`请联系管理员检查服务器API是否正常${r}`,type:"error"})}catch(e){i({title:"连接服务器失败",message:`请检查网络连接${r},${e}`,type:"error"})}}return F(async()=>{await B(),w.value=await E(),I.value=await N()}),(e,n)=>(o(),a(m,null,[t("div",G,[H,t("div",J,[(o(!0),a(m,null,f(w.value,(s,c)=>(o(),a("button",{key:c,onClick:h=>D(c),class:q([{"bg-blue-200 text-gray-700 border border-blue-300":g.value===s,"bg-gray-100 text-gray-500 border border-gray-300":g.value!==s},"px-4 py-2 rounded-full shadow-sm cursor-pointer"])},[t("span",null,b(s),1)],10,K))),128))]),Q,C(t("input",{"onUpdate:modelValue":n[0]||(n[0]=s=>_.value=s),type:"text",id:"instructText",placeholder:"选择或输入特色指令",class:"mb-4 p-2 border border-gray-300 rounded w-4/5"},null,512),[[S,_.value]]),W,C(t("textarea",{"onUpdate:modelValue":n[1]||(n[1]=s=>p.value=s),type:"text",id:"ttsText",placeholder:"请输入 TTS 文本",class:"mb-4 p-2 border border-gray-300 rounded w-4/5"}," ",512),[[S,p.value]]),t("button",{onClick:L,class:"bg-blue-500 text-white py-2 px-4 rounded",disabled:y.value},b(y.value?"加载中...":"生成 TTS 音频"),9,X),u.value?(o(),a("audio",{key:0,ref_key:"audioPlayer",ref:v,onLoadedmetadata:V,onTimeupdate:A,controls:""},[t("source",{src:u.value,type:"audio/wav"},null,8,Z),M(" Your browser does not support the audio tag. ")],544)):U("",!0),u.value?(o(),a("a",{key:1,href:u.value,download:"tts_audio.wav",class:"mt-4 bg-green-500 text-white py-2 px-4 rounded"}," 下载音频 ",8,ee)):U("",!0)]),t("div",te,[se,(o(!0),a(m,null,f(I.value,s=>(o(),a("div",{key:s.name,class:"mb-8"},[t("h2",oe,b(s.name),1),t("div",ae,[t("div",null,[re,t("ul",ne,[(o(!0),a(m,null,f(s.instruct,(c,h)=>(o(),a("li",{key:h,onClick:j=>P(c),class:"cursor-pointer p-2 bg-indigo-100 rounded hover:bg-indigo-200 transition-colors"},b(c),9,le))),128))])]),t("div",null,[ce,t("ul",ie,[(o(!0),a(m,null,f(s.tts_text,(c,h)=>(o(),a("li",{key:h,onClick:j=>R(c),class:"cursor-pointer p-2 bg-green-100 rounded hover:bg-green-200 transition-colors"},b(c),9,ue))),128))])])])]))),128))])],64))}},ve=z(de,[["__scopeId","data-v-13c2c560"]]);export{ve as default};
