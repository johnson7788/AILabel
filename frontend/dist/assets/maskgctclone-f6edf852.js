import{d as L,g as s,h as W,o as n,b as l,a as e,z as g,t as h,j as D,A as F,C as O,F as Q,e as Y,E as r,Q as H,B as J,q as K,s as X,_ as Z}from"./index-f50d6d08.js";import{a as y}from"./axios-a342f982.js";import{W as ee}from"./index-4b1aff9b.js";const p=v=>(K("data-v-bfc6f706"),v=v(),X(),v),te={class:"container mx-auto py-10"},ae={class:"flex flex-col sm:flex-row"},oe={class:"bg-white p-8 rounded-lg shadow-md w-full sm:w-1/2 sm:mr-4 mb-4 sm:mb-0"},se=p(()=>e("p",{class:"text-lg my-2"},"根据提供的声音克隆:，请上传或者从右侧选择1个示例声音",-1)),ne={key:0},le=p(()=>e("label",{for:"audio-file",class:"block text-sm font-medium text-gray-700 mb-2"},"上传参考或录制声音文件",-1)),re={class:"flex justify-between items-center h-16 mb-8 space-x-4"},ce={key:0,class:"w-2/3"},ie=p(()=>e("div",{class:"border h-full"},null,-1)),ue={key:1,class:"w-1/3"},de={key:1,class:"flex justify-between items-center bg-white p-4 rounded shadow hover:shadow-lg transition-shadow"},fe={class:"text-green-700"},pe={class:"mb-4"},ve=p(()=>e("label",{for:"ttsText",class:"block text-sm font-medium text-gray-700 mb-2"},"TTS",-1)),_e=["src"],ge=["href"],he={class:"w-full sm:w-1/2"},me={key:0,class:"space-y-4"},ye=p(()=>e("h2",{class:"text-2xl font-bold text-gray-800"},"选择或者试听文件",-1)),we={class:"grid grid-cols-1 gap-4"},be={class:"text-gray-700"},xe=["onClick"],ke=["onClick"],Ce={key:1,class:"text-center py-5"},$e=p(()=>e("p",{class:"text-gray-500"},"没有找到Audio文件，请检查服务器是否正常",-1)),Be=[$e],Re=L({__name:"maskgctclone",setup(v){const c="https://ai.minitool.fun:15312",w=s([]),b=s(null),P=s(null),i=s(),x=s("你好啊，我是AI机器人"),u=s(null),d=s(),_=s(!1),f=s(null),k=s(!0),C=s(!0),$=s(!0),B=s(!1);function S(t){d.value=t.name,k.value=!1}const I=t=>{C.value=!1;const a=t.target;a.files&&(u.value=a.files[0]),r({title:"上传完成",message:"可以点击克隆了",type:"success"})},E=async()=>{$.value=!1;try{const t=H([]),a=await navigator.mediaDevices.getUserMedia({audio:!0});f.value=new MediaRecorder(a),f.value.ondataavailable=o=>{t.push(o.data)},f.value.onstop=async()=>{const R=await new Blob(t).arrayBuffer(),T=await new AudioContext().decodeAudioData(R),A=[];for(let U=0;U<T.numberOfChannels;U++)A.push(T.getChannelData(U));const q=await ee.encode({sampleRate:T.sampleRate,channelData:A}),G=new Blob([q],{type:"audio/wav"});u.value=new File([G],"recorded_audio.wav",{type:"audio/wav"})},f.value.start(),_.value=!0,r({title:"录制完成",message:"可以点击克隆了",type:"success"})}catch(t){console.error("不能获取麦克风:",t)}},j=()=>{f.value&&(f.value.stop(),_.value=!1)},M=async()=>{if(!u.value&&!d.value){alert("请首先选择参考音频或者上传音频文件或者录音");return}B.value=!0;let t=`tts_text=${encodeURIComponent(x.value)}`;d.value&&(t+=`&wav_path=${encodeURIComponent(d.value)}`);try{if(u.value){const a=new FormData;a.append("prompt_wav",u.value);const o=await y.post(`${c}/api/inference_zero_shot_upload?${t}`,a,{headers:{"Content-Type":"multipart/form-data"}});o.data.code===0?(i.value=c+"/"+o.data.data,u.value=null):(m,r({title:"推理失败",message:"推理失败，请检查服务器"+o.data.msg,type:"error"}))}else{const a=await y.get(`${c}/api/inference_zero_shot_wav_path?${t}`);a.data.code===0?(i.value=c+"/"+a.data.data,d.value=""):r({title:"推理失败",message:"推理失败，请检查服务器"+a.data.msg,type:"error"})}}catch(a){console.error("推理失败，请检查服务器:",a),alert(`推理失败，请检查服务器,${a}`)}B.value=!1,$.value=!0,C.value=!0,k.value=!0},N=async()=>{try{const t=await y.get(`${c}/api/get_reference_audio`);t.data.code===0?(w.value=t.data.data,r({title:"音频文件获取成功",message:"音频文件已成功获取！",type:"success"})):r({title:"获取音频文件错误",message:"获取音频文件失败，请重试。",type:"error"})}catch(t){r({title:"获取音频文件错误",message:"获取音频文件失败，请重试。",type:"error"}),console.error("Error fetching audio files:",t)}},V=t=>{const a=`${c}/api/audio/${t}`;b.value.src=a,b.value.play()};async function z(){try{(await y.get(`${c}/ping`)).data==="Pong"?r({title:"连接服务器成功",message:"开始获取数据",type:"success"}):r({title:"服务器没有返回Pong",message:`请联系管理员检查服务器地址${c}`,type:"error"})}catch(t){r({title:"连接服务器失败",message:`请检查网络连接${c},${t}`,type:"error"})}}return W(async()=>{await z(),await N()}),(t,a)=>(n(),l("div",te,[e("div",ae,[e("div",oe,[se,k.value?(n(),l("div",ne,[le,e("div",re,[$.value?(n(),l("div",ce,[e("input",{type:"file",id:"audio-file",accept:"audio/*",onChange:I,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,32)])):g("",!0),ie,C.value?(n(),l("div",ue,[e("button",{onClick:a[0]||(a[0]=o=>_.value?j():E()),class:"w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"},h(_.value?"停止录制":"开始录制"),1)])):g("",!0)])])):(n(),l("div",de,[D(" 声音: "),e("span",fe,h(d.value),1)])),e("div",pe,[ve,F(e("textarea",{id:"ttsText","onUpdate:modelValue":a[1]||(a[1]=o=>x.value=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入TTS文本"},null,512),[[O,x.value]])]),e("div",null,[e("button",{onClick:M,class:"w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"},h(B.value?"加载中...":"克隆音频"),1)]),i.value?(n(),l("audio",{key:2,ref_key:"audioGeneratePlayer",ref:P,controls:"",class:"my-6"},[e("source",{src:i.value,type:"audio/wav"},null,8,_e),D(" Your browser does not support the audio tag. ")],512)):g("",!0),i.value?(n(),l("a",{key:3,href:i.value,download:"tts_audio.wav",class:"mt-4 bg-green-500 text-white py-2 px-4 rounded"}," 下载音频 ",8,ge)):g("",!0)]),e("div",he,[w.value.length?(n(),l("div",me,[ye,e("ul",we,[(n(!0),l(Q,null,Y(w.value,o=>(n(),l("li",{key:o,class:"flex justify-between items-center bg-white p-4 rounded shadow hover:shadow-lg transition-shadow"},[e("span",be,h(o.name),1),e("div",null,[e("button",{onClick:R=>V(o.name),class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded"}," 播放 ",8,xe),e("button",{onClick:R=>S(o),class:"bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded"}," 参考 ",8,ke)])]))),128))]),F(e("audio",{ref_key:"audioPlayer",ref:b,controls:"",class:"w-full mt-5"},null,512),[[J,!1]])])):(n(),l("div",Ce,Be))])])]))}});const Fe=Z(Re,[["__scopeId","data-v-bfc6f706"]]);export{Fe as default};
