import{l as z}from"./index-e3f35709.js";import{_ as R,o as p,b as m,a,g as n,h as L,f as _,z as k}from"./index-f50d6d08.js";const O={name:"PhoneReceiver",props:{width:{type:[Number,String],default:24},height:{type:[Number,String],default:24}}},V=["width","height"],M=a("g",null,[a("g",null,[a("path",{d:`M12.051,28.452C3.143,39.604-16.659,92.744,68.229,179.759c89.422,91.663,147.124,72.055,157.057,61.712l-59.802-59.802
          c-8.345,8.345-19.11,0.937-39.765-15.904c-13.667-11.143-29.391-26.132-43.025-43.025c-9.566-11.854-18.027-24.301-9.287-33.041
          L12.051,28.452z`})]),a("g",null,[a("path",{d:`M246.906,220.062c3.865-3.865,3.489-9.787-0.041-13.317l0-0.055c0,0-46.637-46.583-46.666-46.611
          c-3.697-3.697-9.609-3.616-13.25,0.026l-16.941,16.941l59.957,59.957c0,0,16.925-16.873,16.925-16.901L246.906,220.062z`})]),a("g",null,[a("path",{d:`M94.975,68.131c3.865-3.865,3.489-9.787-0.041-13.317l0-0.055c0,0-47.982-47.927-48.01-47.955
          c-3.697-3.697-9.609-3.616-13.25,0.026L16.732,23.771l61.302,61.302c0,0,16.925-16.873,16.925-16.901L94.975,68.131z`})])],-1),N=[M];function P(x,l,c,s,v,i){return p(),m("svg",{fill:"#4CAF50",width:c.width,height:c.height,version:"1.2",baseProfile:"tiny",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 256 256","xml:space":"preserve"},N,8,V)}const D=R(O,[["render",P]]),A={name:"PhoneHangup",props:{width:{type:[Number,String],default:24},height:{type:[Number,String],default:24}}},B=["width","height"],T=a("path",{d:"M29.209 14.391c-3.383-3.375-8.052-5.462-13.208-5.462s-9.825 2.087-13.208 5.462l0-0c-0.941 0.952-1.522 2.261-1.522 3.706 0 1.443 0.58 2.751 1.519 3.703l-0.001-0.001 0.002 0.002c0.204 0.21 0.428 0.398 0.671 0.561l0.015 0.009c0.408 0.299 0.886 0.532 1.402 0.673l0.03 0.007c0.054 0.013 0.116 0.021 0.18 0.021h0c0 0 0.001 0 0.001 0 0.165 0 0.318-0.053 0.441-0.144l-0.002 0.001 5.891-4.277c0.188-0.138 0.309-0.359 0.31-0.607v-0c-0.002-0.797-0.187-1.551-0.515-2.221l0.013 0.03c1.41-0.598 3.050-0.945 4.771-0.945s3.361 0.347 4.854 0.976l-0.082-0.031c-0.316 0.641-0.501 1.394-0.502 2.191v0c0 0.248 0.121 0.469 0.307 0.606l0.002 0.001 5.891 4.277c0.125 0.088 0.28 0.14 0.448 0.14 0.061 0 0.121-0.007 0.179-0.020l-0.005 0.001c0.833-0.248 1.546-0.681 2.121-1.252l-0 0c0.939-0.952 1.519-2.26 1.519-3.703s-0.581-2.753-1.521-3.706l0.001 0.001zM28.146 20.74c-0.147 0.151-0.308 0.285-0.483 0.401l-0.011 0.007c-0.177 0.129-0.378 0.243-0.591 0.334l-0.02 0.008-5.252-3.813c0.076-0.658 0.313-1.249 0.672-1.747l-0.008 0.011c0.086-0.12 0.137-0.27 0.137-0.432 0-0.295-0.17-0.55-0.418-0.672l-0.004-0.002c-1.8-0.901-3.922-1.428-6.167-1.428s-4.367 0.527-6.249 1.465l0.081-0.037c-0.252 0.125-0.421 0.38-0.421 0.675 0 0.161 0.051 0.31 0.137 0.432l-0.002-0.002c0.35 0.488 0.588 1.079 0.662 1.72l0.002 0.017-5.252 3.813c-0.247-0.107-0.46-0.229-0.657-0.372l0.01 0.007c-0.171-0.115-0.32-0.241-0.454-0.38l-0.001-0.001c-0.672-0.68-1.088-1.616-1.088-2.648 0-1.031 0.414-1.965 1.085-2.645l-0 0c3.111-3.104 7.404-5.023 12.146-5.023s9.036 1.919 12.147 5.023l-0-0c0.671 0.68 1.085 1.614 1.085 2.645s-0.414 1.965-1.085 2.645l0-0z"},null,-1),I=[T];function U(x,l,c,s,v,i){return p(),m("svg",{fill:"#FF0000",width:c.width,height:c.height,viewBox:"0 0 32 32",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},I,8,B)}const $=R(A,[["render",U]]),F={class:"flex items-center flex-col text-center p-12 min-h-screen bg-gray-100"},E={class:"relative mb-4 bg-gray-200 rounded-xl shadow-md w-full max-w-3xl h-[600px] mx-auto"},H={key:0,class:"absolute bottom-7 left-1/2 transform -translate-x-1/2 flex gap-5 z-10"},q=a("p",{class:"text-white text-lg"},"等待对方接听...",-1),G={key:1,class:"absolute bottom-7 left-1/2 transform -translate-x-1/2 flex gap-5 z-10"},J=a("p",{class:"text-white text-lg"},"收到视频邀请...",-1),K={class:"flex gap-4"},Q="localhost:3000",u="001",Y={__name:"index",setup(x){const l=n(null),c=n(null),s=n(null),v=n(!1),i=n(!1),d=n(!1),g=n(!1),h=n(null),e=n(null),r=n([]),b=async()=>{const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});return c.value.srcObject=t,c.value.play(),h.value=t,t},S=async()=>{i.value=!0,d.value=!0,await b(),l.value.emit("callRemote",u)},j=()=>{l.value.emit("acceptCall",u)},w=()=>{l.value.emit("hangUp",u),y()},y=()=>{h.value&&h.value.getTracks().forEach(t=>t.stop()),e.value&&e.value.close(),v.value=!1,i.value=!1,d.value=!1,g.value=!1,e.value=null,c.value.srcObject=null,s.value.srcObject=null,h.value=null,r.value=[],console.log("挂断结束视频-------")};return L(()=>{l.value=z(Q),l.value.on("connect_error",t=>{console.error("连接失败:",t)}),l.value.on("connectionSuccess",()=>{console.log("连接成功")}),l.value.emit("joinRoom",u),l.value.on("callRemote",()=>{i.value||(v.value=!0,d.value=!0)}),l.value.on("acceptCall",async()=>{if(i.value){e.value=new RTCPeerConnection,e.value.addStream(h.value),e.value.onicecandidate=o=>{o.candidate&&l.value.emit("sendCandidate",{roomId:u,candidate:o.candidate})},e.value.onaddstream=o=>{d.value=!1,g.value=!0,s.value.srcObject=o.stream,s.value.play()};const t=await e.value.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});await e.value.setLocalDescription(t),l.value.emit("sendOffer",{offer:t,roomId:u})}}),l.value.on("sendOffer",async t=>{if(v.value){e.value=new RTCPeerConnection;const o=await b();e.value.addStream(o),e.value.onicecandidate=f=>{f.candidate&&l.value.emit("sendCandidate",{roomId:u,candidate:f.candidate})},e.value.onaddstream=f=>{d.value=!1,g.value=!0,s.value.srcObject=f.stream,s.value.play()},await e.value.setRemoteDescription(t);const C=await e.value.createAnswer();if(await e.value.setLocalDescription(C),l.value.emit("sendAnswer",{answer:C,roomId:u}),r.value){for(const f of r.value)await e.value.addIceCandidate(f);r.value=[]}}}),l.value.on("sendAnswer",async t=>{if(i.value&&(await e.value.setRemoteDescription(t),r.value)){for(const o of r.value)await e.value.addIceCandidate(o);r.value=[]}}),l.value.on("sendCandidate",async t=>{e.value&&e.value.remoteDescription?await e.value.addIceCandidate(t):r.value.push(t)}),l.value.on("hangUp",()=>{y()})}),(t,o)=>(p(),m("div",F,[a("div",E,[a("video",{ref_key:"remoteVideo",ref:s,class:"w-full h-full object-cover"},null,512),a("video",{ref_key:"localVideo",ref:c,class:"absolute right-5 bottom-5 w-[180px] h-[120px] rounded-lg border-2 border-white shadow-lg"},null,512),i.value&&d.value?(p(),m("div",H,[q,a("div",{class:"icon-wrapper",onClick:w},[_($,{class:"call-icon"})])])):k("",!0),v.value&&d.value?(p(),m("div",G,[J,a("div",K,[a("div",{class:"icon-wrapper",onClick:w},[_($,{class:"call-icon reject"})]),a("div",{class:"icon-wrapper",onClick:j},[_(D,{class:"call-icon accept"})])])])):k("",!0)]),a("div",{class:"flex gap-4 mt-6"},[a("button",{onClick:S,class:"bg-green-500 text-white py-3 px-8 rounded-full text-lg shadow-md hover:bg-green-600 active:scale-95 transition"},"发起视频"),a("button",{onClick:w,class:"bg-red-500 text-white py-3 px-8 rounded-full text-lg shadow-md hover:bg-red-600 active:scale-95 transition"},"挂断视频")])]))}};export{Y as default};
