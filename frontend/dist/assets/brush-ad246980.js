import{d as xt,s as W,g as ht}from"./transform-4a56bf00.js";import{i as At}from"./value-0eb832c3.js";import{p as pt}from"./pointer-b52b12f8.js";import{d as zt,y as Dt}from"./nodrag-71d5223e.js";const Z=t=>()=>t;function Mt(t,{sourceEvent:A,target:I,selection:R,mode:X,dispatch:S}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:A,enumerable:!0,configurable:!0},target:{value:I,enumerable:!0,configurable:!0},selection:{value:R,enumerable:!0,configurable:!0},mode:{value:X,enumerable:!0,configurable:!0},_:{value:S}})}function Tt(t){t.stopImmediatePropagation()}function tt(t){t.preventDefault(),t.stopImmediatePropagation()}var mt={name:"drag"},et={name:"space"},B={name:"handle"},G={name:"center"};const{abs:dt,max:k,min:_}=Math;function bt(t){return[+t[0],+t[1]]}function st(t){return[bt(t[0]),bt(t[1])]}var nt={name:"x",handles:["w","e"].map($),input:function(t,A){return t==null?null:[[+t[0],A[0][1]],[+t[1],A[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},rt={name:"y",handles:["n","s"].map($),input:function(t,A){return t==null?null:[[A[0][0],+t[0]],[A[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Xt={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map($),input:function(t){return t==null?null:st(t)},output:function(t){return t}},T={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},yt={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},gt={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Yt={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Kt={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function $(t){return{type:t}}function Ot(t){return!t.ctrlKey&&!t.button}function Pt(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function St(){return navigator.maxTouchPoints||"ontouchstart"in this}function it(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function Ct(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function Rt(){return Nt(Xt)}function Nt(t){var A=Pt,I=Ot,R=St,X=!0,S=xt("start","brush","end"),D=6,j;function p(e){var n=e.property("__brush",kt).selectAll(".overlay").data([$("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",T.overlay).merge(n).each(function(){var r=it(this).extent;W(this).attr("x",r[0][0]).attr("y",r[0][1]).attr("width",r[1][0]-r[0][0]).attr("height",r[1][1]-r[0][1])}),e.selectAll(".selection").data([$("selection")]).enter().append("rect").attr("class","selection").attr("cursor",T.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var s=e.selectAll(".handle").data(t.handles,function(r){return r.type});s.exit().remove(),s.enter().append("rect").attr("class",function(r){return"handle handle--"+r.type}).attr("cursor",function(r){return T[r.type]}),e.each(V).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",at).filter(R).on("touchstart.brush",at).on("touchmove.brush",wt).on("touchend.brush touchcancel.brush",vt).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}p.move=function(e,n,s){e.tween?e.on("start.brush",function(r){C(this,arguments).beforestart().start(r)}).on("interrupt.brush end.brush",function(r){C(this,arguments).end(r)}).tween("brush",function(){var r=this,u=r.__brush,a=C(r,arguments),E=u.selection,M=t.input(typeof n=="function"?n.apply(this,arguments):n,u.extent),l=At(E,M);function z(o){u.selection=o===1&&M===null?null:l(o),V.call(r),a.brush()}return E!==null&&M!==null?z:z(1)}):e.each(function(){var r=this,u=arguments,a=r.__brush,E=t.input(typeof n=="function"?n.apply(r,u):n,a.extent),M=C(r,u).beforestart();ht(r),a.selection=E===null?null:E,V.call(r),M.start(s).brush(s).end(s)})},p.clear=function(e,n){p.move(e,null,n)};function V(){var e=W(this),n=it(this).selection;n?(e.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),e.selectAll(".handle").style("display",null).attr("x",function(s){return s.type[s.type.length-1]==="e"?n[1][0]-D/2:n[0][0]-D/2}).attr("y",function(s){return s.type[0]==="s"?n[1][1]-D/2:n[0][1]-D/2}).attr("width",function(s){return s.type==="n"||s.type==="s"?n[1][0]-n[0][0]+D:D}).attr("height",function(s){return s.type==="e"||s.type==="w"?n[1][1]-n[0][1]+D:D})):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function C(e,n,s){var r=e.__brush.emitter;return r&&(!s||!r.clean)?r:new ut(e,n,s)}function ut(e,n,s){this.that=e,this.args=n,this.state=e.__brush,this.active=0,this.clean=s}ut.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(e,n){return this.starting?(this.starting=!1,this.emit("start",e,n)):this.emit("brush",e),this},brush:function(e,n){return this.emit("brush",e,n),this},end:function(e,n){return--this.active===0&&(delete this.state.emitter,this.emit("end",e,n)),this},emit:function(e,n,s){var r=W(this.that).datum();S.call(e,this.that,new Mt(e,{sourceEvent:n,target:p,selection:t.output(this.state.selection),mode:s,dispatch:S}),r)}};function at(e){if(j&&!e.touches||!I.apply(this,arguments))return;var n=this,s=e.target.__data__.type,r=(X&&e.metaKey?s="overlay":s)==="selection"?mt:X&&e.altKey?G:B,u=t===rt?null:Yt[s],a=t===nt?null:Kt[s],E=it(n),M=E.extent,l=E.selection,z=M[0][0],o,m,Y=M[0][1],d,b,K=M[1][0],y,g,O=M[1][1],w,v,c=0,f=0,U,q=u&&a&&X&&e.shiftKey,J,Q,x=Array.from(e.touches||[e],i=>{const h=i.identifier;return i=pt(i,n),i.point0=i.slice(),i.identifier=h,i});ht(n);var F=C(n,arguments,!0).beforestart();if(s==="overlay"){l&&(U=!0);const i=[x[0],x[1]||x[0]];E.selection=l=[[o=t===rt?z:_(i[0][0],i[1][0]),d=t===nt?Y:_(i[0][1],i[1][1])],[y=t===rt?K:k(i[0][0],i[1][0]),w=t===nt?O:k(i[0][1],i[1][1])]],x.length>1&&N(e)}else o=l[0][0],d=l[0][1],y=l[1][0],w=l[1][1];m=o,b=d,g=y,v=w;var ot=W(n).attr("pointer-events","none"),H=ot.selectAll(".overlay").attr("cursor",T[s]);if(e.touches)F.moved=ct,F.ended=ft;else{var lt=W(e.view).on("mousemove.brush",ct,!0).on("mouseup.brush",ft,!0);X&&lt.on("keydown.brush",_t,!0).on("keyup.brush",Et,!0),zt(e.view)}V.call(n),F.start(e,r.name);function ct(i){for(const h of i.changedTouches||[i])for(const L of x)L.identifier===h.identifier&&(L.cur=pt(h,n));if(q&&!J&&!Q&&x.length===1){const h=x[0];dt(h.cur[0]-h[0])>dt(h.cur[1]-h[1])?Q=!0:J=!0}for(const h of x)h.cur&&(h[0]=h.cur[0],h[1]=h.cur[1]);U=!0,tt(i),N(i)}function N(i){const h=x[0],L=h.point0;var P;switch(c=h[0]-L[0],f=h[1]-L[1],r){case et:case mt:{u&&(c=k(z-o,_(K-y,c)),m=o+c,g=y+c),a&&(f=k(Y-d,_(O-w,f)),b=d+f,v=w+f);break}case B:{x[1]?(u&&(m=k(z,_(K,x[0][0])),g=k(z,_(K,x[1][0])),u=1),a&&(b=k(Y,_(O,x[0][1])),v=k(Y,_(O,x[1][1])),a=1)):(u<0?(c=k(z-o,_(K-o,c)),m=o+c,g=y):u>0&&(c=k(z-y,_(K-y,c)),m=o,g=y+c),a<0?(f=k(Y-d,_(O-d,f)),b=d+f,v=w):a>0&&(f=k(Y-w,_(O-w,f)),b=d,v=w+f));break}case G:{u&&(m=k(z,_(K,o-c*u)),g=k(z,_(K,y+c*u))),a&&(b=k(Y,_(O,d-f*a)),v=k(Y,_(O,w+f*a)));break}}g<m&&(u*=-1,P=o,o=y,y=P,P=m,m=g,g=P,s in yt&&H.attr("cursor",T[s=yt[s]])),v<b&&(a*=-1,P=d,d=w,w=P,P=b,b=v,v=P,s in gt&&H.attr("cursor",T[s=gt[s]])),E.selection&&(l=E.selection),J&&(m=l[0][0],g=l[1][0]),Q&&(b=l[0][1],v=l[1][1]),(l[0][0]!==m||l[0][1]!==b||l[1][0]!==g||l[1][1]!==v)&&(E.selection=[[m,b],[g,v]],V.call(n),F.brush(i,r.name))}function ft(i){if(Tt(i),i.touches){if(i.touches.length)return;j&&clearTimeout(j),j=setTimeout(function(){j=null},500)}else Dt(i.view,U),lt.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);ot.attr("pointer-events","all"),H.attr("cursor",T.overlay),E.selection&&(l=E.selection),Ct(l)&&(E.selection=null,V.call(n)),F.end(i,r.name)}function _t(i){switch(i.keyCode){case 16:{q=u&&a;break}case 18:{r===B&&(u&&(y=g-c*u,o=m+c*u),a&&(w=v-f*a,d=b+f*a),r=G,N(i));break}case 32:{(r===B||r===G)&&(u<0?y=g-c:u>0&&(o=m-c),a<0?w=v-f:a>0&&(d=b-f),r=et,H.attr("cursor",T.selection),N(i));break}default:return}tt(i)}function Et(i){switch(i.keyCode){case 16:{q&&(J=Q=q=!1,N(i));break}case 18:{r===G&&(u<0?y=g:u>0&&(o=m),a<0?w=v:a>0&&(d=b),r=B,N(i));break}case 32:{r===et&&(i.altKey?(u&&(y=g-c*u,o=m+c*u),a&&(w=v-f*a,d=b+f*a),r=G):(u<0?y=g:u>0&&(o=m),a<0?w=v:a>0&&(d=b),r=B),H.attr("cursor",T[s]),N(i));break}default:return}tt(i)}}function wt(e){C(this,arguments).moved(e)}function vt(e){C(this,arguments).ended(e)}function kt(){var e=this.__brush||{selection:null};return e.extent=st(A.apply(this,arguments)),e.dim=t,e}return p.extent=function(e){return arguments.length?(A=typeof e=="function"?e:Z(st(e)),p):A},p.filter=function(e){return arguments.length?(I=typeof e=="function"?e:Z(!!e),p):I},p.touchable=function(e){return arguments.length?(R=typeof e=="function"?e:Z(!!e),p):R},p.handleSize=function(e){return arguments.length?(D=+e,p):D},p.keyModifiers=function(e){return arguments.length?(X=!!e,p):X},p.on=function(){var e=S.on.apply(S,arguments);return e===S?p:e},p}export{Rt as b};
