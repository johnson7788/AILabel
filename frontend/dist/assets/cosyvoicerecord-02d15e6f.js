import{d as $,g as c,h as z,r as N,o as w,b as x,a as e,A as V,P as A,t as R,p as F,F as I,j as _,f as j,w as U,E as a,W,q as L,s as P,_ as q}from"./index-f50d6d08.js";import{a as b}from"./axios-a342f982.js";import{W as H}from"./index-4b1aff9b.js";const s=d=>(L("data-v-e41339f8"),d=d(),P(),d),O={class:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},G={class:"max-w-md w-full space-y-8"},J=s(()=>e("div",{class:"text-center"},[e("h2",{class:"mt-6 text-3xl font-extrabold text-gray-900"}," 声音克隆 ")],-1)),K={class:"bg-white p-8 rounded-lg shadow-md"},Q={class:"mb-4"},X=s(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"选择语言",-1)),Y=s(()=>e("option",{value:"zh"},"中文",-1)),Z=s(()=>e("option",{value:"en"},"英文",-1)),ee=[Y,Z],te={class:"mb-6"},se=s(()=>e("p",{class:"text-lg font-medium text-gray-900 mb-3"},"请朗读以下文本：",-1)),ae={class:"p-4 bg-gray-100 rounded-md text-lg"},oe={class:"flex flex-col items-center"},ne=s(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-4"},"按住录制声音",-1)),ce={class:"relative"},re=["disabled"],ie={key:1,class:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},le=s(()=>e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1)),de=s(()=>e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)),ue=[le,de],pe={class:"mt-6 text-sm text-gray-600 text-center"},me=$({__name:"cosyvoicerecord",setup(d){const v="https://ai.minitool.fun:15302",h=c("zh"),f=c(""),r=c(!1),o=c(null),g=c([]),u=c(!1),B=async()=>{try{const t=await b.get(`${v}/api/get_sentence?language=${h.value}`);t.data.code===0&&(f.value=t.data.data)}catch(t){a({title:"获取句子失败",message:String(t),type:"error"})}},C=async()=>{try{g.value=[];const t=await navigator.mediaDevices.getUserMedia({audio:!0});o.value=new MediaRecorder(t),o.value.ondataavailable=n=>{g.value.push(n.data)},o.value.start(),r.value=!0}catch(t){console.error("无法获取麦克风:",t),a({title:"错误",message:"无法获取麦克风权限",type:"error"})}},y=async()=>{!o.value||!r.value||(o.value.stop(),r.value=!1,o.value.onstop=async()=>{try{u.value=!0;const n=await new Blob(g.value).arrayBuffer(),i=await new AudioContext().decodeAudioData(n),D=[];for(let l=0;l<i.numberOfChannels;l++)D.push(i.getChannelData(l));const S=await H.encode({sampleRate:i.sampleRate,channelData:D}),E=new Blob([S],{type:"audio/wav"}),p=new Date().getTime().toString(),T=new File([E],`${p}.wav`,{type:"audio/wav"}),M=new FormData;M.append("prompt_wav",T),(await b.post(`${v}/api/clone_voice`,M,{params:{prompt_text:f.value,spk_id:p},headers:{"Content-Type":"multipart/form-data"}})).data.code===0&&(a({title:"成功",message:"声音克隆成功",type:"success"}),W.prompt("现有声音名称："+p+"，是否要修改声音的名称？","修改名称",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[^\s]{1,20}$/,inputErrorMessage:"名称格式不正确（不能包含空格，长度1-20）"}).then(async({value:l})=>{try{const m=await b.get(`${v}/api/change_voice_name`,{params:{old_name:p,new_name:l}});if(m.data.code===0)a({title:"成功",message:"声音名称修改成功",type:"success"});else throw new Error(m.data.message||"修改失败")}catch(m){a({title:"错误",message:`修改名称失败: ${m.message}`,type:"error"})}}).catch(()=>{a({title:"提示",message:"将使用默认名称",type:"info"})}))}catch{a({title:"错误",message:"声音克隆失败",type:"error"})}finally{u.value=!1}})};return z(async()=>{await B()}),(t,n)=>{const k=N("router-link");return w(),x("div",O,[e("div",G,[J,e("div",K,[e("div",Q,[X,V(e("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>h.value=i),onChange:B,class:"w-full p-2 border rounded-md"},ee,544),[[A,h.value]])]),e("div",te,[se,e("div",ae,R(f.value),1)]),e("div",oe,[ne,e("div",ce,[e("button",{onTouchstart:C,onTouchend:y,onMousedown:C,onMouseup:y,onMouseleave:y,disabled:u.value,class:F(["w-32 h-32 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 flex items-center justify-center transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",{"bg-red-500 hover:bg-red-600":r.value}])},[u.value?(w(),x("svg",ie,ue)):(w(),x(I,{key:0},[_(R(r.value?"录制中...":"按住录制"),1)],64))],42,re)]),e("p",pe,[_(" 克隆完成后请访问 "),j(k,{to:"/audio/cosyvoicetts",class:"text-blue-500 hover:text-blue-600"},{default:U(()=>[_("声音测试页面")]),_:1}),_(" 测试吧 ")])])])])])}}});const ge=q(me,[["__scopeId","data-v-e41339f8"]]);export{ge as default};
