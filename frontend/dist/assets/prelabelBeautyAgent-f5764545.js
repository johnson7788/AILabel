import{d as D,g as f,k as O,h as U,r as k,o as x,b as $,f as d,a as i,A as F,P as L,F as V,e as M,t as C,w as A,j as T,E as r}from"./index-f50d6d08.js";import{a as P}from"./axios-a342f982.js";import{_ as G}from"./navHeader.vue_vue_type_script_setup_true_lang-f1ba1dcd.js";import{f as I,s as N,h as z,q as H}from"./api-a3faf747.js";const J={class:"w-full"},K={class:"flex flex-row justify-between items-center ml-2"},R=i("option",{disabled:"",selected:""},"所有prompt对应的问题指令",-1),W={class:"mr-10"},X=i("div",{class:"divider"},null,-1),Y={class:"flex float-end"},Z=["disabled"],ee=["disabled"],ie=D({__name:"prelabelBeautyAgent",setup(te){const v=f(),c=f(),b=f(0),p=f([]),E="https://ai.minitool.fun:15557",g=f(!1);O(c,async(o,s)=>{b.value=v.value.filter(n=>n.name===o)[0].number,console.log("total_question_num",b.value);const a=v.value.filter(n=>n.name===o)[0].questions;await B(a)});async function Q(){if(!c.value){r({title:"错误",message:"请先选择prompt",type:"warning"});return}g.value=!0;const o=10;for(let s=0;s<o;s++){const a=await P.post(`${E}/api/generate_qa`,{workflow:!0,project:"beauty"});console.log(a);const n=a.data,t=n.msg;let e=[];if(n.code==0){const l=n.data,m=l.question,h=l.output,y=l.workflow_output,q=l.intermidiates;e.push({id:1,role:"user",content:m}),e.push({id:e[e.length-1].id+1,role:"SOP",content:y}),q.forEach(u=>{u.status==="AgentAction"?(e.push({id:e[e.length-1].id+1,role:"thought",content:u.thought}),e.push({id:e[e.length-1].id+1,role:"observation",content:u.observation})):e.push({id:e[e.length-1].id+1,role:"thought",content:u.thought})}),e.push({id:e[e.length-1].id+1,role:"assistant",content:h,meta:l});const w=await N({prompt:c.value,messages:e,collection:"llmlabel"});if(console.log("save_res",w),w.code===0){const u=await z({question:m,prompt:c.value});console.log("question_res",u),r({title:"成功",message:`第${s+1}个问题生成回答和保存成功`,type:"success"})}else r({title:"错误",message:`第${s+1}个问题保存回答失败:`+t,type:"warning"})}else r({title:"错误",message:`第${s+1}个问题生成回答失败:`+t,type:"warning"})}g.value=!1}async function S(){if(!c.value){r({title:"错误",message:"请先选择prompt",type:"warning"});return}const o=p.value.filter(s=>s.checked);console.log("开始对这些questions进行回答:",o),o.forEach(async(s,a)=>{g.value=!0;const n=s.id;let t=[{id:1,role:"user",content:s.question}];const e=await P.post(`${E}/api/answer_messages`,{workflow:!0,messages:t,project:"beauty"});console.log(e);const l=e.data,m=l.msg;if(l.code==0){const h=l.data,y=h.output,q=h.workflow_output,w=h.intermidiates;t.push({id:t[t.length-1].id+1,role:"SOP",content:q}),w.forEach(_=>{_.status==="AgentAction"?(t.push({id:t[t.length-1].id+1,role:"thought",content:_.thought}),t.push({id:t[t.length-1].id+1,role:"observation",content:_.observation})):t.push({id:t[t.length-1].id+1,role:"thought",content:_.thought})}),t.push({id:t[t.length-1].id+1,role:"assistant",content:y,meta:h});const u=await N({id:n,prompt:c.value,messages:t,collection:"llmlabel"});console.log("save_res",u),u.code===0?r({title:"成功",message:`第${a+1}个问题生成回答成功`,type:"success"}):r({title:"错误",message:`第${a+1}个问题保存回答失败:`+m,type:"warning"})}else r({title:"错误",message:`第${a+1}个问题生成回答失败:`+m,type:"warning"});g.value=!1})}function j(){if(!c.value){r({title:"错误",message:"请先选择prompt",type:"warning"});return}p.value.forEach(o=>{o.checked=!o.checked})}async function B(o){const s=await H({questions:o});console.log("query_questions result",s);const a=s.data;p.value=a.map(n=>(n.status==="unlabeled"&&(n.checked=!0),n))}return U(async()=>{const o=await I();console.log(o.data),v.value=o.data}),(o,s)=>{const a=k("el-table-column"),n=k("el-checkbox"),t=k("el-table");return x(),$(V,null,[d(G),i("section",null,[i("div",J,[i("div",K,[F(i("select",{class:"select select-bordered w-full max-w-xs","onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e)},[R,(x(!0),$(V,null,M(v.value,e=>(x(),$("option",null,C(e.name),1))),256))],512),[[L,c.value]]),i("div",W,"问题数量: "+C(b.value),1)]),X]),i("div",Y,[i("button",{class:"btn btn-info mr-4",onClick:j},"反选"),i("button",{class:"btn btn-success mr-4",disabled:g.value,onClick:S},"生成回答",8,Z),i("button",{class:"btn btn-warning mr-4",disabled:g.value,onClick:Q},"QA生成",8,ee)]),d(t,{data:p.value,style:{width:"100%"},class:"mt-10"},{default:A(()=>[d(a,{prop:"id",label:"id",width:"200"}),d(a,{prop:"question",label:"question",width:"600"}),d(a,{prop:"status",label:"status",width:"200"}),d(a,{fixed:"right",label:"Operations",width:"400"},{default:A(e=>[d(n,{modelValue:p.value[e.$index].checked,"onUpdate:modelValue":l=>p.value[e.$index].checked=l},{default:A(()=>[T("勾选")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])])],64)}}});export{ie as default};
