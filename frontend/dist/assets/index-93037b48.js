import{a as Xt}from"./axios-a342f982.js";import{j as Pt,k as Ot,R as Et,C as It,r as Yt,n as it,l as Qt,s as B}from"./transform-4a56bf00.js";import{l as xt,m as Rt,b as qt,d as Vt,e as Dt,f as te}from"./linear-2c590633.js";import{d as F,h as G,o as z,b as L,a as U,g as q,y as et,r as Z,f as V,w as D,F as st,e as ct,c as J,j as ee,q as ne,s as ae,_ as Tt,z as Y}from"./index-f50d6d08.js";import{c as rt}from"./create-8bd90eea.js";import{N as re,c as oe,h as le}from"./index-43d88f95.js";import{o as ie}from"./ordinal-0ac01f5e.js";import{c as se}from"./category10-484dc76e.js";import{s as ce,m as de}from"./manyBody-52170d67.js";import{l as ue,x as fe,y as he,d as pe}from"./y-d5417789.js";import{c as me}from"./center-5b19297c.js";import"./value-0eb832c3.js";import"./nodrag-71d5223e.js";import"./pointer-b52b12f8.js";function _e(t,n){let e;if(n===void 0)for(const r of t)r!=null&&(e>r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let a of t)(a=n(a,++r,t))!=null&&(e>a||e===void 0&&a>=a)&&(e=a)}return e}const ye=Math.PI/180,ge=180/Math.PI,at=18,Lt=.96422,Ut=1,Jt=.82521,Wt=4/29,K=6/29,Kt=3*K*K,xe=K*K*K;function Bt(t){if(t instanceof E)return new E(t.l,t.a,t.b,t.opacity);if(t instanceof T)return Ht(t);t instanceof Et||(t=Yt(t));var n=ht(t.r),e=ht(t.g),r=ht(t.b),a=dt((.2225045*n+.7168786*e+.0606169*r)/Ut),o,l;return n===e&&e===r?o=l=a:(o=dt((.4360747*n+.3850649*e+.1430804*r)/Lt),l=dt((.0139322*n+.0971045*e+.7141733*r)/Jt)),new E(116*a-16,500*(o-a),200*(a-l),t.opacity)}function ve(t,n,e,r){return arguments.length===1?Bt(t):new E(t,n,e,r??1)}function E(t,n,e,r){this.l=+t,this.a=+n,this.b=+e,this.opacity=+r}Pt(E,ve,Ot(It,{brighter(t){return new E(this.l+at*(t??1),this.a,this.b,this.opacity)},darker(t){return new E(this.l-at*(t??1),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,n=isNaN(this.a)?t:t+this.a/500,e=isNaN(this.b)?t:t-this.b/200;return n=Lt*ut(n),t=Ut*ut(t),e=Jt*ut(e),new Et(ft(3.1338561*n-1.6168667*t-.4906146*e),ft(-.9787684*n+1.9161415*t+.033454*e),ft(.0719453*n-.2289914*t+1.4052427*e),this.opacity)}}));function dt(t){return t>xe?Math.pow(t,1/3):t/Kt+Wt}function ut(t){return t>K?t*t*t:Kt*(t-Wt)}function ft(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ht(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function be(t){if(t instanceof T)return new T(t.h,t.c,t.l,t.opacity);if(t instanceof E||(t=Bt(t)),t.a===0&&t.b===0)return new T(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var n=Math.atan2(t.b,t.a)*ge;return new T(n<0?n+360:n,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function yt(t,n,e,r){return arguments.length===1?be(t):new T(t,n,e,r??1)}function T(t,n,e,r){this.h=+t,this.c=+n,this.l=+e,this.opacity=+r}function Ht(t){if(isNaN(t.h))return new E(t.l,0,0,t.opacity);var n=t.h*ye;return new E(t.l,Math.cos(n)*t.c,Math.sin(n)*t.c,t.opacity)}Pt(T,yt,Ot(It,{brighter(t){return new T(this.h,this.c,this.l+at*(t??1),this.opacity)},darker(t){return new T(this.h,this.c,this.l-at*(t??1),this.opacity)},rgb(){return Ht(this).rgb()}}));function we(t){return function(n,e){var r=t((n=yt(n)).h,(e=yt(e)).h),a=it(n.c,e.c),o=it(n.l,e.l),l=it(n.opacity,e.opacity);return function(u){return n.h=r(u),n.c=a(u),n.l=o(u),n.opacity=l(u),n+""}}}const ke=we(Qt);function nt(t){return t==null?null:$e(t)}function $e(t){if(typeof t!="function")throw new Error;return t}function wt(){return 0}function Ae(t){return function(){return t}}const Se=1664525,Me=1013904223,kt=4294967296;function ze(){let t=1;return()=>(t=(Se*t+Me)%kt)/kt}function Ne(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function je(t,n){let e=t.length,r,a;for(;e;)a=n()*e--|0,r=t[e],t[e]=t[a],t[a]=r;return t}function Ce(t,n){for(var e=0,r=(t=je(Array.from(t),n)).length,a=[],o,l;e<r;)o=t[e],l&&Zt(l,o)?++e:(l=Oe(a=Pe(a,o)),e=0);return l}function Pe(t,n){var e,r;if(pt(n,t))return[n];for(e=0;e<t.length;++e)if(Q(n,t[e])&&pt(H(t[e],n),t))return[t[e],n];for(e=0;e<t.length-1;++e)for(r=e+1;r<t.length;++r)if(Q(H(t[e],t[r]),n)&&Q(H(t[e],n),t[r])&&Q(H(t[r],n),t[e])&&pt(Ft(t[e],t[r],n),t))return[t[e],t[r],n];throw new Error}function Q(t,n){var e=t.r-n.r,r=n.x-t.x,a=n.y-t.y;return e<0||e*e<r*r+a*a}function Zt(t,n){var e=t.r-n.r+Math.max(t.r,n.r,1)*1e-9,r=n.x-t.x,a=n.y-t.y;return e>0&&e*e>r*r+a*a}function pt(t,n){for(var e=0;e<n.length;++e)if(!Zt(t,n[e]))return!1;return!0}function Oe(t){switch(t.length){case 1:return Ee(t[0]);case 2:return H(t[0],t[1]);case 3:return Ft(t[0],t[1],t[2])}}function Ee(t){return{x:t.x,y:t.y,r:t.r}}function H(t,n){var e=t.x,r=t.y,a=t.r,o=n.x,l=n.y,u=n.r,i=o-e,f=l-r,c=u-a,d=Math.sqrt(i*i+f*f);return{x:(e+o+i/d*c)/2,y:(r+l+f/d*c)/2,r:(d+a+u)/2}}function Ft(t,n,e){var r=t.x,a=t.y,o=t.r,l=n.x,u=n.y,i=n.r,f=e.x,c=e.y,d=e.r,s=r-l,m=r-f,p=a-u,g=a-c,_=i-o,h=d-o,w=r*r+a*a-o*o,v=w-l*l-u*u+i*i,b=w-f*f-c*c+d*d,k=m*p-s*g,C=(p*b-g*v)/(k*2)-r,O=(g*_-p*h)/k,S=(m*v-s*b)/(k*2)-a,N=(s*h-m*_)/k,I=O*O+N*N-1,y=2*(o+C*O+S*N),$=C*C+S*S-o*o,P=-(Math.abs(I)>1e-6?(y+Math.sqrt(y*y-4*I*$))/(2*I):$/y);return{x:r+C+O*P,y:a+S+N*P,r:P}}function $t(t,n,e){var r=t.x-n.x,a,o,l=t.y-n.y,u,i,f=r*r+l*l;f?(o=n.r+e.r,o*=o,i=t.r+e.r,i*=i,o>i?(a=(f+i-o)/(2*f),u=Math.sqrt(Math.max(0,i/f-a*a)),e.x=t.x-a*r-u*l,e.y=t.y-a*l+u*r):(a=(f+o-i)/(2*f),u=Math.sqrt(Math.max(0,o/f-a*a)),e.x=n.x+a*r-u*l,e.y=n.y+a*l+u*r)):(e.x=n.x+e.r,e.y=n.y)}function At(t,n){var e=t.r+n.r-1e-6,r=n.x-t.x,a=n.y-t.y;return e>0&&e*e>r*r+a*a}function St(t){var n=t._,e=t.next._,r=n.r+e.r,a=(n.x*e.r+e.x*n.r)/r,o=(n.y*e.r+e.y*n.r)/r;return a*a+o*o}function tt(t){this._=t,this.next=null,this.previous=null}function Ie(t,n){if(!(o=(t=Ne(t)).length))return 0;var e,r,a,o,l,u,i,f,c,d,s;if(e=t[0],e.x=0,e.y=0,!(o>1))return e.r;if(r=t[1],e.x=-r.r,r.x=e.r,r.y=0,!(o>2))return e.r+r.r;$t(r,e,a=t[2]),e=new tt(e),r=new tt(r),a=new tt(a),e.next=a.previous=r,r.next=e.previous=a,a.next=r.previous=e;t:for(i=3;i<o;++i){$t(e._,r._,a=t[i]),a=new tt(a),f=r.next,c=e.previous,d=r._.r,s=e._.r;do if(d<=s){if(At(f._,a._)){r=f,e.next=r,r.previous=e,--i;continue t}d+=f._.r,f=f.next}else{if(At(c._,a._)){e=c,e.next=r,r.previous=e,--i;continue t}s+=c._.r,c=c.previous}while(f!==c.next);for(a.previous=e,a.next=r,e.next=r.previous=r=a,l=St(e);(a=a.next)!==r;)(u=St(a))<l&&(e=a,l=u);r=e.next}for(e=[r._],a=r;(a=a.next)!==r;)e.push(a._);for(a=Ce(e,n),i=0;i<o;++i)e=t[i],e.x-=a.x,e.y-=a.y;return a.r}function Re(t){return Math.sqrt(t.value)}function qe(){var t=null,n=1,e=1,r=wt;function a(o){const l=ze();return o.x=n/2,o.y=e/2,t?o.eachBefore(Mt(t)).eachAfter(mt(r,.5,l)).eachBefore(zt(1)):o.eachBefore(Mt(Re)).eachAfter(mt(wt,1,l)).eachAfter(mt(r,o.r/Math.min(n,e),l)).eachBefore(zt(Math.min(n,e)/(2*o.r))),o}return a.radius=function(o){return arguments.length?(t=nt(o),a):t},a.size=function(o){return arguments.length?(n=+o[0],e=+o[1],a):[n,e]},a.padding=function(o){return arguments.length?(r=typeof o=="function"?o:Ae(+o),a):r},a}function Mt(t){return function(n){n.children||(n.r=Math.max(0,+t(n)||0))}}function mt(t,n,e){return function(r){if(a=r.children){var a,o,l=a.length,u=t(r)*n||0,i;if(u)for(o=0;o<l;++o)a[o].r+=u;if(i=Ie(a,e),u)for(o=0;o<l;++o)a[o].r-=u;r.r=i+u}}}function zt(t){return function(n){var e=n.parent;n.r*=t,e&&(n.x=e.x+t*n.x,n.y=e.y+t*n.y)}}var Ve={depth:-1},Nt={},_t={};function De(t){return t.id}function Te(t){return t.parentId}function jt(){var t=De,n=Te,e;function r(a){var o=Array.from(a),l=t,u=n,i,f,c,d,s,m,p,g,_=new Map;if(e!=null){const h=o.map((b,k)=>Le(e(b,k,a))),w=h.map(Ct),v=new Set(h).add("");for(const b of w)v.has(b)||(v.add(b),h.push(b),w.push(Ct(b)),o.push(_t));l=(b,k)=>h[k],u=(b,k)=>w[k]}for(c=0,i=o.length;c<i;++c)f=o[c],m=o[c]=new re(f),(p=l(f,c,a))!=null&&(p+="")&&(g=m.id=p,_.set(g,_.has(g)?Nt:m)),(p=u(f,c,a))!=null&&(p+="")&&(m.parent=p);for(c=0;c<i;++c)if(m=o[c],p=m.parent){if(s=_.get(p),!s)throw new Error("missing: "+p);if(s===Nt)throw new Error("ambiguous: "+p);s.children?s.children.push(m):s.children=[m],m.parent=s}else{if(d)throw new Error("multiple roots");d=m}if(!d)throw new Error("no root");if(e!=null){for(;d.data===_t&&d.children.length===1;)d=d.children[0],--i;for(let h=o.length-1;h>=0&&(m=o[h],m.data===_t);--h)m.data=null}if(d.parent=Ve,d.eachBefore(function(h){h.depth=h.parent.depth+1,--i}).eachBefore(oe),d.parent=null,i>0)throw new Error("cycle");return d}return r.id=function(a){return arguments.length?(t=nt(a),r):t},r.parentId=function(a){return arguments.length?(n=nt(a),r):n},r.path=function(a){return arguments.length?(e=nt(a),r):e},r}function Le(t){t=`${t}`;let n=t.length;return gt(t,n-1)&&!gt(t,n-2)&&(t=t.slice(0,-1)),t[0]==="/"?t:`/${t}`}function Ct(t){let n=t.length;if(n<2)return"";for(;--n>1&&!gt(t,n););return t.slice(0,n)}function gt(t,n){if(t[n]==="/"){let e=0;for(;n>0&&t[--n]==="\\";)++e;if(!(e&1))return!0}return!1}const Ue={class:"main"},Je=U("div",{class:"description"}," 统计情感数量 ",-1),We=U("div",{class:"SentimentCountPlot"},null,-1),Ke=[Je,We],Be=F({__name:"sentimentCounter",props:{data:{type:Array,required:!0},data_info:{type:Object,required:!0}},setup(t){const n=t;function e(a,o,l,u,i){console.log(`要绘制的数据是: ${JSON.stringify(a)}, x轴的key是: ${o}, 选择器是: ${l}, 颜色是: ${JSON.stringify(i)}`);const f={top:100,right:0,bottom:50,left:70},c=1e3,d=600,s=h=>h.attr("transform",`translate(${f.left},0)`).call(Vt(p)).call(w=>w.select(".domain").remove()),m=h=>h.attr("transform",`translate(0,${d-f.bottom})`).call(Dt(g).tickSizeOuter(0)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),p=xt().domain([0,Rt(a,h=>h.value)]).nice().range([d-f.bottom,f.top]),g=qt().domain(a.map(h=>h.name)).range([f.left,c-f.right]).padding(.1),_=rt("svg").attr("width",c).attr("height",d);_.append("g").selectAll("rect").data(a).join("rect").attr("x",h=>g(h.name)).attr("y",h=>p(h.value)).attr("height",h=>p(0)-p(h.value)).attr("width",g.bandwidth()).attr("fill",h=>i[h.name]).on("click",function(){B(this).transition().duration(100).attr("filter","brightness(150%)").transition().duration(100).attr("filter","brightness(100%)")}),_.append("g").attr("fill","black").selectAll("text").data(a).join("text").text(h=>h.value).attr("x",h=>g(h.name)+g.bandwidth()/2).attr("y",h=>p(h.value)).attr("height",h=>p(0)-p(h.value)).attr("width",g.bandwidth()).attr("text-anchor","middle").attr("dy","-0.5em").attr("font-family","helvetica").attr("font-size",15),_.append("text").text("数量").attr("x",g.bandwidth()).attr("y",p(98)).attr("text-anchor","middle").attr("dy","-0.5em").attr("font-family","helvetica").attr("font-size",15),_.append("g").call(m),_.append("g").call(s),_.append("text").text(u).attr("x",(c-f.left-f.right)/2).attr("y",f.top/2).attr("text-anchor","middle").attr("font-family","helvetica").attr("font-size",20),B(l).append(()=>_.node())}function r(a){for(const o of n.data_info.brands){const l=a.filter(c=>c.keyword==o);let u={};for(const c of l)for(const d of c.data){const s=d.类型;u[s]=u[s]?u[s]+1:1}let i=[];for(const c in u)i.push({name:c,value:u[c]});i.sort((c,d)=>{const s=n.data_info.sentiment_types.indexOf(c.name),m=n.data_info.sentiment_types.indexOf(d.name);return s-m});const f=`${o}的2个月的情感数量分布`;e(i,"name",".SentimentCountPlot",f,n.data_info.sentiment_color);for(const c of n.data_info.month){const d=l.filter(g=>g.datetime.slice(0,7)==c);let s={};for(const g of d)for(const _ of g.data){const h=_.类型;s[h]=s[h]?s[h]+1:1}let m=[];for(const g in s)m.push({name:g,value:s[g]});m.sort((g,_)=>{const h=n.data_info.sentiment_types.indexOf(g.name),w=n.data_info.sentiment_types.indexOf(_.name);return h-w});const p=`${o}在${c}月的情感数量分布`;e(m,"name",".SentimentCountPlot",p,n.data_info.sentiment_color)}}}return G(()=>{r(n.data)}),(a,o)=>(z(),L("div",Ue,Ke))}}),He={class:"main"},Ze=U("div",{class:"description"}," 统计情感强度 ",-1),Fe=U("div",{class:"SentimentStrengthPlot"},null,-1),Ge=[Ze,Fe],Xe=F({__name:"sentimentStrength",props:{data:{type:Array,required:!0},data_info:{type:Object,required:!0}},setup(t){const n=t;function e(a,{path:o,id:l=Array.isArray(a)?$=>$.id:null,parentId:u=Array.isArray(a)?$=>$.parentId:null,children:i,value:f,sort:c=($,P)=>te($.value,P.value),label:d,title:s,link:m,linkTarget:p="_blank",width:g=640,height:_=400,margin:h=1,marginTop:w=h,marginRight:v=h,marginBottom:b=h,marginLeft:k=h,padding:C=3,fill:O="#ddd",fillOpacity:S,stroke:N="#bbb",strokeWidth:I,strokeOpacity:y}={}){const $=xt().domain([0,5]).range(["hsl(152,80%,80%)","hsl(228,30%,40%)"]).interpolate(ke),P=o!=null?jt().path(o)(a):l!=null||u!=null?jt().id(l).parentId(u)(a):le(a,i);f==null?P.count():P.sum(x=>Math.max(0,f(x)));const W=P.descendants(),R=W.filter(x=>!x.children);R.forEach((x,A)=>x.index=A);const j=d==null?null:R.map(x=>d(x.data,x)),vt=s==null?null:W.map(x=>s(x.data,x));c!=null&&P.sort(c),qe().size([g-k-v,_-w-b]).padding(C)(P);const bt=rt("svg").attr("viewBox",[-k,-w,g,_]).attr("width",g).attr("height",_).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size",10).style("background",$(0)).attr("text-anchor","middle"),X=bt.selectAll("a").data(W).join("a").attr("xlink:href",m==null?null:(x,A)=>m(x.data,x)).attr("target",m==null?null:p).attr("transform",x=>`translate(${x.x},${x.y})`);if(X.append("circle").attr("fill",x=>$(x.depth)).attr("fill-opacity",x=>x.children?null:S).attr("stroke",x=>x.children?N:null).attr("stroke-width",x=>x.children?I:null).attr("stroke-opacity",x=>x.children?y:null).attr("r",x=>x.r),W.filter(x=>x.children)&&X.filter(A=>A.children).append("text").style("fill-opacity",A=>1).style("display",A=>"inline").attr("x",0).attr("y",A=>A.height*-150).attr("font-size","20px").call(A=>console.log(A)).text(A=>A.data.name),vt&&X.append("title").text((x,A)=>vt[A]).attr("class","title"),j){const x=`O-${Math.random().toString(16).slice(2)}`,A=X.filter(M=>!M.children&&M.r>10&&j[M.index]!=null);A.append("clipPath").attr("id",M=>`${x}-clip-${M.index}`).append("circle").attr("r",M=>M.r),A.append("text").attr("clip-path",M=>`url(${new URL(`#${x}-clip-${M.index}`,location)})`).selectAll("tspan").data(M=>`${j[M.index]}`.split(/\n/g)).join("tspan").attr("x",0).attr("y",(M,ot,lt)=>`${ot-lt.length/2+.85}em`).attr("fill-opacity",(M,ot,lt)=>ot===lt.length-1?.7:null).text(M=>M)}return bt.node()}function r(a){const o={name:"brand",children:[]};for(const l of n.data_info.brands){let u=[];for(const i of n.data_info.month){let f=[];for(const c of n.data_info.sentiment_types)f.push({name:c,size:0});u.push({name:i,children:f})}o.children.push({name:l,children:u})}for(const l of a){const u=l.keyword,i=l.data,c=l.datetime.slice(0,7);for(const d of i){const s=d.强度,m=d.类型;o.children.find(p=>p.name===u).children.find(p=>p.name===c).children.find(p=>p.name===m).size+=s}}for(const l of o.children)for(const u of l.children)for(const i of u.children)i.size||(i.size=0),i.name||console.log("数据name为空，请检查:",u.children);return console.log(`ToPackData: ${JSON.stringify(o)}`),o}return G(()=>{const a=document.documentElement.clientWidth,o=1e3,l=r(n.data),u=e(l,{value:i=>i.size,label:(i,f)=>[...i.name.split(/(?=[A-Z][a-z])/g),f.value.toLocaleString("en")].join(`
`),title:(i,f)=>`${f.ancestors().reverse().map(({data:c})=>c.name).join(".")}
${f.value.toLocaleString("en")}`,width:a,height:o});B(".SentimentStrengthPlot").append(()=>u)}),(a,o)=>(z(),L("div",He,Ge))}}),Ye={class:"main"},Qe=U("div",{class:"description"}," 统计情感变化 ",-1),tn=U("div",{class:"SentimentTrendPlot"},null,-1),en=[Qe,tn],nn=F({__name:"sentimentTrend",props:{data:{type:Array,required:!0},data_info:{type:Object,required:!0}},setup(t){const n=t;function e(o,l,u){const i={top:60,right:0,bottom:30,left:40},f=800,c=f/1.5;console.log(l);const d=xt().domain([_e(l,v=>v.avg_strength),Rt(l,v=>v.avg_strength)]).rangeRound([c-i.bottom,i.top]),s=Array.from(new Set(l.map(v=>v.day)));console.log(s);const m=qt().domain(s).rangeRound([i.left,f-i.right]);console.log(m("2023-08-29"));const p=rt("svg").attr("width",f).attr("height",c).attr("viewBox",[0,0,f,c]);p.append("text").attr("x",f/1.5).attr("y",i.top/2).attr("text-anchor","end").attr("font-size",20).attr("font-weight","bold").attr("fill","gray").text(u),p.append("g").attr("transform",`translate(0,${c-i.bottom})`),p.append("g").call(Dt(m)).attr("transform",`translate(0, ${c-i.bottom})`).selectAll("text").attr("transform","rotate(90)").style("text-anchor","start").append("text").attr("font-family","sans-serif").attr("font-size",10).attr("x",f/2).attr("y",i.bottom-5).attr("text-anchor","end").attr("fill","black").attr("font-weight","bold").text("Day →"),p.append("g").attr("transform",`translate(${i.left},0)`).call(Vt(d).ticks(5)).append("text").attr("fill","black").attr("font-family","sans-serif").attr("font-size",10).attr("font-weight","bold").attr("transform","rotate(-90)").attr("y",-30).attr("x",-c/2).text("Strength →");const h=4,w="#B5C8EC";p.append("g").selectAll("circle").data(l).join("circle").attr("cx",v=>m(v.day)).attr("cy",v=>d(v.avg_strength)).attr("fill",w).attr("r",h),B(o).append(()=>p.node())}function r(o){let l={};for(const u of n.data_info.brands)l[u]={};for(const u of o){const i=u.keyword,f=u.data,d=u.datetime.slice(5,10);l[i][d]||(l[i][d]={});for(const s of f){const m=s.强度,p=s.类型;l[i][d][p]||(l[i][d][p]=[]),l[i][d][p].push(m)}}for(const u in l)for(const i in l[u])for(const f in l[u][i]){const c=l[u][i][f],d=c.reduce((s,m)=>s+m,0)/c.length;l[u][i][f]=d}return console.log(l),l}function a(o){for(const l in o){let u=[];for(const f in o[l]){let c=0;for(const d in o[l][f]){const s=o[l][f][d];c+=s}c/=Object.keys(o[l][f]).length,u.push({day:f,avg_strength:c})}u.sort((f,c)=>new Date(f.day)-new Date(c.day));const i=`${l}情感的每日变化趋势`;e(".SentimentTrendPlot",u,i)}}return G(()=>{document.documentElement.clientWidth;const o=r(n.data);a(o)}),(o,l)=>(z(),L("div",Ye,en))}}),Gt=t=>(ne("data-v-f2898572"),t=t(),ae(),t),an={class:"main"},rn=Gt(()=>U("div",{class:"description"}," 统计各个关系 ",-1)),on=Gt(()=>U("div",{class:"SentimentRelationPlot"},null,-1)),ln=F({__name:"sentimentRelation",props:{data:{type:Array,required:!0},data_info:{type:Object,required:!0}},setup(t){const n=q("资生堂"),e=q("2023-12"),r=q("满意"),a=t,o=et(()=>{let d=[];return d.push({label:"all",value:"all"}),a.data_info.brands.forEach(s=>{d.push({label:s,value:s})}),d}),l=et(()=>{let d=[];return d.push({label:"all",value:"all"}),a.data_info.month.forEach(s=>{d.push({label:s,value:s})}),d}),u=et(()=>{let d=[];return d.push({label:"all",value:"all"}),a.data_info.sentiment_types.forEach(s=>{d.push({label:s,value:s})}),d});function i(d,s){B(d).selectAll("*").remove(),console.log(s);const g=Array.from(new Set(s.map(y=>y.type)));console.log(new Date,"关系的类型有",g);const _={links:s};let h=[];for(const y of s)h.some($=>$.id===y.source)||h.push({id:y.source,type:y.source_type,color:y.source_color}),h.some($=>$.id===y.target)||h.push({id:y.target,type:y.target_type,color:y.target_color});_.nodes=h,console.log(new Date,"节点link和nodes信息",_);const w=ie(g,se);function v(y){return`
    M${y.source.x},${y.source.y}
    A0,0 0 0,1 ${y.target.x},${y.target.y}
  `}const b=y=>{function $(R,j){R.active||y.alphaTarget(.3).restart(),j.fx=j.x,j.fy=j.y}function P(R,j){j.fx=R.x,j.fy=R.y}function W(R,j){R.active||y.alphaTarget(0),j.fx=null,j.fy=null}return pe().on("start",$).on("drag",P).on("end",W)},k=_.links.map(y=>Object.create(y)),C=_.nodes.map(y=>Object.create(y));console.log("nodes",C),console.log("links",k);const O=ce(C).force("link",ue(k).id(y=>y.id)).force("charge",de().strength(-5e3)).force("center",me(1400/2,1e3/2)).force("x",fe(1400/2)).force("y",he(1e3/2)),S=rt("svg").attr("viewBox",[0,0,1400,1e3]).attr("width",1400).attr("height",1e3).style("font","10px sans-serif").attr("text-anchor","middle");S.append("defs").selectAll("marker").data(g).join("marker").attr("id",y=>`arrow-${y}`).attr("viewBox","0 -5 10 10").attr("refX",53).attr("refY",-.5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("path").attr("fill",w).attr("d","M0,-5L10,0L0,5");const N=S.append("g").attr("fill","none").attr("stroke-width",1.5).selectAll("path").data(k).join("path").attr("stroke",y=>w(y.type)).attr("marker-end",y=>`url(${new URL(`#arrow-${y.type}`,location)})`),I=S.selectAll("a").data(C).join("a").attr("target",N==null?null:"_blank").call(b(O));I.append("circle").attr("stroke","white").attr("stroke-width",1.5).attr("r",30).attr("fill",y=>y.color).call(y=>console.log(y.color)),I.append("text").attr("fill","white").attr("x",y=>y.id.length*-2.5).attr("y","0.31em").text(y=>y.id.replace(" ",`
`)).clone(!0).lower().attr("fill","black").attr("stroke","black").attr("stroke-width",3).attr("text-anchor","middle"),O.on("tick",()=>{N.attr("d",v),I.attr("transform",y=>`translate(${y.x},${y.y})`)}),B(d).append(()=>S.node())}function f(d){let s=[];for(const m of d){const p=m.keyword;if(n.value!=="all"&&n.value!==p)continue;const g=m.data,_=m.datetime;_.slice(0,10);const h=_.slice(0,7);if(!(e.value!=="all"&&e.value!==h))for(const w of g){w.强度;const v=w.类型,b=w.原因;r.value!=="all"&&r.value!==v||(s.push({source:p,target:v,type:"sentiment",source_type:"brand",target_type:"sentiment",source_color:a.data_info.brand_color[p],target_color:a.data_info.sentiment_color[v]}),s.push({source:v,target:b,type:"reason",source_type:"sentiment",target_type:"word",source_color:a.data_info.sentiment_color[v],target_color:"#bcf48b"}))}}return console.log(`共有${s.length}条关系数据`,s),s=Array.from(new Set(s.map(JSON.stringify))).map(JSON.parse),console.log(`去重后，共有${s.length}条关系数据`,s),s}function c(){let d=f(a.data);i(".SentimentRelationPlot",d)}return G(()=>{}),(d,s)=>{const m=Z("el-option"),p=Z("el-select"),g=Z("el-button");return z(),L("div",an,[rn,V(p,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=_=>n.value=_),class:"m-2",placeholder:"Brand",size:"large",style:{width:"240px"}},{default:D(()=>[(z(!0),L(st,null,ct(o.value,_=>(z(),J(m,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),V(p,{modelValue:e.value,"onUpdate:modelValue":s[1]||(s[1]=_=>e.value=_),class:"m-2",placeholder:"Month",size:"large",style:{width:"240px"}},{default:D(()=>[(z(!0),L(st,null,ct(l.value,_=>(z(),J(m,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),V(p,{modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=_=>r.value=_),class:"m-2",placeholder:"Sentiment",size:"large",style:{width:"240px"}},{default:D(()=>[(z(!0),L(st,null,ct(u.value,_=>(z(),J(m,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),V(g,{type:"primary",onClick:c},{default:D(()=>[ee("Plot")]),_:1}),on])}}});const sn=Tt(ln,[["__scopeId","data-v-f2898572"]]);function cn(t){var n=2147483648,e=1103515245,r=12345,a=t;this.next=function(){return a=(e*a+r)%n,a/n}}const dn={class:"main"},un=F({__name:"index",setup(t){const n=q([]),e=q(!1),r=q(!1),a=q(!1),o=q(!1),l=c=>{n.value.includes("1")&&(e.value=!0),n.value.includes("2")&&(r.value=!0),n.value.includes("3")&&(a.value=!0),n.value.includes("4")&&(o.value=!0)},u=q(null),i=et(()=>{let c=0,d=5,s=[],m={},p=[],g=[];if(u.value===null)return;for(const v of u.value){Array.isArray(v.data)||console.log("注意，发现空数据，请检查",v);const b=v.keyword;p.includes(b)||p.push(b);const C=v.datetime.slice(0,7);g.includes(C)||g.push(C);for(const O of v.data){const S=O.强度;S<c&&(c=S),S>d&&(d=S);const N=O.类型;N||console.log("注意，发现空情感类型，请检查",O),!s.includes(N)&&N&&s.push(N)}}console.log("情感强度范围",c,d),console.log("所有的品牌:",p),console.log("所有的情感类型:",s),console.log("获取的月份数量:",g);var _=new cn(42);for(const v of s){const b=Math.floor(_.next()*16777215).toString(16);m[v]="#"+b}let h={};for(const v of p){const b=Math.floor(_.next()*16777215).toString(16);h[v]="#"+b}return console.log("品牌颜色",h),{min_sentiment:c,max_sentiment:d,brands:p,sentiment_types:s,sentiment_color:m,month:g,brand_color:h}});async function f(c){try{return(await Xt.get(c)).data}catch(d){throw d}}return G(async()=>{let c;try{c=await f("http://127.0.0.1:5401/api/reuslt")}catch{console.log("获取服务器数据失败，使用本地数据"),c=await f("/assets/result.json")}console.log(c),u.value=c.data}),(c,d)=>{const s=Z("el-collapse-item"),m=Z("el-collapse");return z(),L("div",dn,[V(m,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=p=>n.value=p),onChange:l},{default:D(()=>[V(s,{title:"情感数量",name:"1"},{default:D(()=>[e.value?(z(),J(Be,{key:0,data:u.value,data_info:i.value},null,8,["data","data_info"])):Y("",!0)]),_:1}),V(s,{title:"情感强度",name:"2"},{default:D(()=>[r.value?(z(),J(Xe,{key:0,data:u.value,data_info:i.value},null,8,["data","data_info"])):Y("",!0)]),_:1}),V(s,{title:"情感变化",name:"3"},{default:D(()=>[a.value?(z(),J(nn,{key:0,data:u.value,data_info:i.value},null,8,["data","data_info"])):Y("",!0)]),_:1}),V(s,{title:"关系",name:"4"},{default:D(()=>[o.value?(z(),J(sn,{key:0,data:u.value,data_info:i.value},null,8,["data","data_info"])):Y("",!0)]),_:1})]),_:1},8,["modelValue"])])}}});const Mn=Tt(un,[["__scopeId","data-v-370888d2"]]);export{Mn as default};
