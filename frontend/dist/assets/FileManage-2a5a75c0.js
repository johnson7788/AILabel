import{d as E,L as U,g as r,o as i,b as d,a as e,t as _,z as w,k as D,h as R,F as C,e as S,E as x,f as k,p as N,i as F,A as P,C as j}from"./index-f50d6d08.js";import{u as L}from"./store-93e037d2.js";import{_ as G}from"./navbar.vue_vue_type_script_setup_true_lang-6e8001dc.js";import"./axios-a342f982.js";const M={class:"w-full max-w-md mx-auto p-4 bg-white rounded-lg shadow"},z=e("h2",{class:"text-xl font-bold mb-4"},"上传文件",-1),O={class:"space-y-4"},B=["disabled"],V={key:0,class:"text-red-600 text-sm mt-2"},H=E({__name:"FileUpload",emits:["fileUploaded","error"],setup(T,{emit:v}){const{data_dir:b}=U(L()),m="https://open.minitool.fun:15307",c=v,n=r(null),a=r(!1),l=r(""),f=h=>{const t=h.target;t.files&&(n.value=t.files[0],l.value="")},p=async()=>{if(!n.value)return;const h=new FormData;h.append("file",n.value);try{a.value=!0,l.value="";const t=await fetch(`${m}/api/uploads/${b.value}`,{method:"POST",body:h});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();c("fileUploaded"),n.value=null,document.querySelector('input[type="file"]')&&(document.querySelector('input[type="file"]').value="")}catch(t){const s=t instanceof Error?t.message:"Failed to upload file";l.value=s,c("error",s)}finally{a.value=!1}};return(h,t)=>(i(),d("div",M,[z,e("div",O,[e("input",{type:"file",onChange:f,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),e("button",{onClick:p,disabled:!n.value||a.value,class:"w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},_(a.value?"上传中...":"上传"),9,B),l.value?(i(),d("div",V,_(l.value),1)):w("",!0)])]))}}),q={class:"w-full max-w-4xl mx-auto p-4 bg-white rounded-lg shadow mt-8"},A=e("h2",{class:"text-xl font-bold mb-4"},"文件管理",-1),J=["disabled"],I={key:0,class:"mb-4 p-3 bg-red-100 text-red-700 rounded"},K={key:1,class:"text-center py-4"},Q={key:2,class:"text-center py-4 text-gray-500"},W={key:3,class:"overflow-x-auto"},X={class:"min-w-full table-auto"},Y=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"px-4 py-2 text-left"},"Filename"),e("th",{class:"px-4 py-2 text-left"},"Size"),e("th",{class:"px-4 py-2 text-left"},"Created At"),e("th",{class:"px-4 py-2 text-left"},"Graph Status"),e("th",{class:"px-4 py-2 text-left"},"Delete"),e("th",{class:"px-4 py-2 text-left"},"Graph")])],-1),Z={class:"px-4 py-2"},ee={class:"px-4 py-2"},te={class:"px-4 py-2"},se={class:"px-4 py-2"},ae={class:"px-4 py-2"},le=["onClick"],oe={class:"px-4 py-2"},ne=["onClick"],re=E({__name:"FileList",setup(T,{expose:v}){const{data_dir:b}=U(L()),m="https://open.minitool.fun:15307",c=r([]),n=r(!1),a=r("");async function l(t){n.value=!0,a.value="";try{const s=await fetch(`${m}/api/genGraph`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:t,data_dir:b.value})}),o=await s.json();s.ok?x({title:"成功",message:o.data,type:"success"}):x({title:"错误",message:o.msg||"请求失败",type:"error"})}catch{a.value="请求过程中发生错误",x({title:"错误",message:a.value,type:"error"})}finally{n.value=!1}}D(b,()=>{p()});function f(){p()}const p=async()=>{try{n.value=!0,a.value="";const t=await fetch(`${m}/api/files/${b.value}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();s.code==0?c.value=s.data:(a.value=s.msg,console.error("Failed to load files:",s.data.msg))}catch(t){const s=t instanceof Error?t.message:"Failed to load files";a.value=s,console.error("Failed to load files:",s)}finally{n.value=!1}},h=async t=>{try{a.value="";const s=await fetch(`${m}/api/files/${b.value}/${t}`,{method:"DELETE"});if(s.ok)x({message:`删除文件${t}成功`,type:"success"});else throw new Error(`HTTP error! status: ${s.status}`);await p()}catch(s){const o=s instanceof Error?s.message:"Failed to delete file";a.value=o,console.error("Failed to delete file:",o)}};return R(p),v({loadFiles:p}),(t,s)=>(i(),d("div",q,[A,e("button",{onClick:f,disabled:n.value,class:"w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}," 刷新 ",8,J),a.value?(i(),d("div",I,_(a.value),1)):w("",!0),n.value?(i(),d("div",K," Loading files... ")):c.value.length===0?(i(),d("div",Q," No files uploaded yet ")):(i(),d("div",W,[e("table",X,[Y,e("tbody",null,[(i(!0),d(C,null,S(c.value,o=>(i(),d("tr",{key:o.filename,class:"border-b"},[e("td",Z,_(o.filename),1),e("td",ee,_(Math.round(o.size/1024))+" KB",1),e("td",te,_(new Date(o.created_at).toLocaleString()),1),e("td",se,_(o.graph_status),1),e("td",ae,[e("button",{onClick:$=>h(o.filename),class:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700"}," Delete ",8,le)]),e("td",oe,[e("button",{onClick:$=>l(o.filename),class:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700"}," GenGraph ",8,ne)])]))),128))])])]))]))}}),ie={class:"flex h-screen bg-gray-100"},de={class:"w-1/3 p-4 bg-white shadow-md"},ce={key:0,class:"max-w-md mx-auto mb-4 p-3 bg-red-100 text-red-700 rounded"},ue=e("label",{class:"block text-gray-700 text-sm font-bold"},"上传的文件目录: ",-1),pe={class:"py-8 flex flex-wrap gap-2"},fe={class:"flex flex-wrap gap-2"},he=["onClick"],_e={class:"mb-4"},ve=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"url-input"}," 输入URL ",-1),be=["disabled"],me={key:1,class:"text-center py-4"},ye={class:"w-2/3 p-4 bg-white shadow-md ml-4"},Fe=E({__name:"FileManage",setup(T){const{data_dir:v,data_dir_list:b}=U(L()),m="https://open.minitool.fun:15307",c=r(""),n=r([]);r([]),r("");const a=r(null),l=r(""),f=r(!1),p=r(!1),h=async u=>{v.value=u},t=()=>{const u=/^https?:\/\/.+/i;f.value=u.test(c.value),l.value=f.value?"":"请输入有效的网页链接(必须以 http:// 或 https:// 开头)"},s=()=>{var u;(u=a.value)==null||u.loadFiles(),l.value=""},o=u=>{l.value=u};async function $(){if(c.value){f.value=!0,p.value=!0;try{const u=await fetch(`${m}/api/upload_url/${v.value}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:c.value})}),y=await u.json();u.ok&&y.code==0?(n.value.push({id:Date.now(),name:y.data}),c.value="",x({title:"成功",message:"上传成功: "+y.data,type:"success"})):l.value=y.msg||"获取内容失败"}catch{l.value="请求失败，请检查网络连接"}finally{f.value=!1,p.value=!1}}}return(u,y)=>(i(),d(C,null,[k(G),e("div",ie,[e("div",de,[l.value?(i(),d("div",ce,_(l.value),1)):w("",!0),ue,e("div",pe,[e("div",fe,[(i(!0),d(C,null,S(F(b),g=>(i(),d("button",{key:g.id,onClick:ge=>h(g.name),class:N([{"bg-blue-200 text-gray-700 border border-blue-300":F(v)===g.name,"bg-gray-100 text-gray-500 border border-gray-300":F(v)!==g.name},"px-4 py-2 rounded-full shadow-sm cursor-pointer"])},[e("span",null,_(g.name),1)],10,he))),128))])]),k(H,{onFileUploaded:s,onError:o}),e("div",_e,[ve,P(e("input",{id:"url-input","onUpdate:modelValue":y[0]||(y[0]=g=>c.value=g),type:"text",placeholder:"https://my-ip.cc/zh-hans",onInput:t,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,544),[[j,c.value]])]),e("button",{onClick:$,disabled:!f.value,class:"w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}," 添加URL ",8,be),p.value?(i(),d("div",me," 解析URL中... ")):w("",!0)]),e("div",ye,[k(re,{ref_key:"fileListRef",ref:a},null,512)])])],64))}});export{Fe as default};
