import{o,b as l,a as y,L as B,E as d,d as T,g as $,h as A,r as p,F as x,e as z,z as q,j as N,t as C,i as O,f as v,w as h}from"./index-f50d6d08.js";import{u as M}from"./navHeader.vue_vue_type_script_setup_true_lang-5f81fcc5.js";import{e as I}from"./api-e233926e.js";const U=["stroke","fill"],j=y("path",{d:"m617.24 354a126.36 126.36 0 0 0 -10.86-103.79 127.8 127.8 0 0 0 -137.65-61.32 126.36 126.36 0 0 0 -95.31-42.49 127.81 127.81 0 0 0 -121.92 88.49 126.4 126.4 0 0 0 -84.5 61.3 127.82 127.82 0 0 0 15.72 149.86 126.36 126.36 0 0 0 10.86 103.79 127.81 127.81 0 0 0 137.65 61.32 126.36 126.36 0 0 0 95.31 42.49 127.81 127.81 0 0 0 121.96-88.54 126.4 126.4 0 0 0 84.5-61.3 127.82 127.82 0 0 0 -15.76-149.81zm-190.66 266.49a94.79 94.79 0 0 1 -60.85-22c.77-.42 2.12-1.16 3-1.7l101-58.34a16.42 16.42 0 0 0 8.3-14.37v-142.39l42.69 24.65a1.52 1.52 0 0 1 .83 1.17v117.92a95.18 95.18 0 0 1 -94.97 95.06zm-204.24-87.23a94.74 94.74 0 0 1 -11.34-63.7c.75.45 2.06 1.25 3 1.79l101 58.34a16.44 16.44 0 0 0 16.59 0l123.31-71.2v49.3a1.53 1.53 0 0 1 -.61 1.31l-102.1 58.95a95.16 95.16 0 0 1 -129.85-34.79zm-26.57-220.49a94.71 94.71 0 0 1 49.48-41.68c0 .87-.05 2.41-.05 3.48v116.68a16.41 16.41 0 0 0 8.29 14.36l123.31 71.19-42.69 24.65a1.53 1.53 0 0 1 -1.44.13l-102.11-59a95.16 95.16 0 0 1 -34.79-129.81zm350.74 81.62-123.31-71.2 42.69-24.64a1.53 1.53 0 0 1 1.44-.13l102.11 58.95a95.08 95.08 0 0 1 -14.69 171.55c0-.88 0-2.42 0-3.49v-116.68a16.4 16.4 0 0 0 -8.24-14.36zm42.49-63.95c-.75-.46-2.06-1.25-3-1.79l-101-58.34a16.46 16.46 0 0 0 -16.59 0l-123.31 71.2v-49.3a1.53 1.53 0 0 1 .61-1.31l102.1-58.9a95.07 95.07 0 0 1 141.19 98.44zm-267.11 87.87-42.7-24.65a1.52 1.52 0 0 1 -.83-1.17v-117.92a95.07 95.07 0 0 1 155.9-73c-.77.42-2.11 1.16-3 1.7l-101 58.34a16.41 16.41 0 0 0 -8.3 14.36zm23.19-50 54.92-31.72 54.92 31.7v63.42l-54.92 31.7-54.92-31.7z"},null,-1),J=[j],se={__name:"IconOpenAI",props:{color:{type:String,default:"#00DC82"}},setup(n){return(m,e)=>(o(),l("svg",{width:"100%",height:"100%",stroke:n.color,fill:n.color,"stroke-width":"0",viewBox:"140 140 520 520",xmlns:"http://www.w3.org/2000/svg"},J,8,U))}},L=["fill","stroke"],P=y("path",{d:"M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"},null,-1),Q=y("path",{"fill-rule":"evenodd",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"},null,-1),R=[P,Q],ae={__name:"IconPerson",props:{color:{type:String,default:"#00DC82"}},setup(n){return(m,e)=>(o(),l("svg",{fill:n.color,stroke:n.color,width:"100%",height:"100%","stroke-width":"0",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},R,8,L))}},{currentQuestion:S,messages:w,function_result:G}=B(M());async function H(){let n="";if(S.value.question)n=S.value.question;else if(w.value[w.value.length-1].role==="function_call")n=w.value[w.value.length-1].content;else{d.error("当前输入中为空而且上一条消息也不是函数调用，无法运行函数");return}const m=JSON.parse(n);try{const e=await I(m),s=e.data;if(console.log("Function result:",s),e.code===0){if(s.includes("Traceback")){d({message:`运行函数失败，请检查输入参数或者api,错误信息包括Traceback：${s}`,type:"error"});return}G.value=s,d({message:"函数运行成功",type:"info"})}else d({message:`运行函数失败，请检查输入参数或者api,错误代码出现：${e.msg}`,type:"error"})}catch(e){d({message:`运行函数失败，请检查输入参数或者api,错误没有调用成功：${e}`,type:"error"})}}const K={class:"function"},W=["onClick"],X={key:0,class:"loading loading-spinner"},Y={key:0},oe=T({__name:"functionDrawer",setup(n){const{currentQuestion:m,tools_data:e}=B(M()),s=$(new Map),f=$(!1),k=$("");async function D(t){const r=e.value[t].params;console.log("提交参数:",r);let u=!0;if(r.forEach(i=>{i.required&&!i.value&&(d({message:`参数${i.name}为必填项，请检查`,type:"warning"}),u=!1)}),u){let i=r.reduce((g,_)=>(g[_.name]=_.value,g),{});const b=JSON.stringify({name:t,arguments:i});m.value.question=b,d({message:"参数提交成功",type:"info"}),f.value=!1,k.value=t,await H(),k.value=""}}function E(t){Object.keys(e.value).map(r=>{s.value.set(r,!1)}),s.value.set(t,!s.value.get(t)),console.log("显示drawer:",t,s.value),f.value=!0}return A(async()=>{console.log("tools_data",e.value),e.value&&Object.keys(e.value).map(t=>{s.value.set(t,!1);const r=e.value[t].params;for(let u=0;u<r.length;u++)e.value[t].params[u].value=""})}),(t,r)=>{const u=p("el-input"),i=p("el-form-item"),V=p("el-form"),b=p("el-button"),g=p("el-drawer");return o(),l("div",K,[(o(!0),l(x,null,z(O(e),(_,c)=>(o(),l("button",{class:"btn btn-outline btn-success",key:c,onClick:a=>E(c),text:"",bg:""},[k.value===c?(o(),l("span",X)):q("",!0),N(" "+C(c),1)],8,W))),128)),(o(!0),l(x,null,z(O(e),(_,c)=>(o(),l("div",{key:c},[s.value.get(c)?(o(),l("div",Y,[v(g,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=a=>f.value=a),title:_.description,"with-header":!0},{default:h(()=>[(o(!0),l(x,null,z(_.params,a=>(o(),l("div",{class:"params",key:a.name},[v(V,{"label-width":"120px"},{default:h(()=>[v(i,{label:a.name},{default:h(()=>[y("div",null,C(a.type)+": "+C(a.description),1),v(u,{modelValue:a.value,"onUpdate:modelValue":F=>a.value=F,placeholder:a.required?"必填":"可选"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])]),_:2},1024)]))),128)),v(b,{type:"success",onClick:a=>D(c)},{default:h(()=>[N("确认")]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","title"])])):q("",!0)]))),128))])}}});export{ae as _,se as a,oe as b};
