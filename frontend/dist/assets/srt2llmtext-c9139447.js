import{d as E,g as a,h as R,o as u,b as r,f as U,A as k,B as S,a as e,F as N,e as T,t as d,z as y,P as j,j as z,E as w}from"./index-f50d6d08.js";import{a as A}from"./axios-a342f982.js";import{l as G}from"./index-e3f35709.js";import{G as I,C as W,_ as q,h as J}from"./navbar.vue_vue_type_script_setup_true_lang-1f4df18c.js";const O={class:"main"},X=e("h1",null," SRT文件被LLM整理成text文件 ",-1),H={class:"my-auto"},K=["value"],P={key:0},Q={class:"mt-6"},Y=e("span",null,"选择1个SRT文件：",-1),Z=["value"],ee={class:"loading loading-spinner"},se={key:0,class:"mt-4 whitespace-pre-line"},te=e("h3",{class:"text-lg font-bold"},"消息:",-1),le={key:1,class:"mt-4 whitespace-pre-line"},oe=e("h3",{class:"text-lg font-bold"},"结果:",-1),ae={key:2,class:"mt-4 text-red-500 whitespace-pre-line"},ne=e("h3",{class:"text-lg font-bold"},"错误:",-1),ve=E({__name:"srt2llmtext",setup(ce){const C="https://ai.minitool.fun:15554",F=a([]),b=a(),m=a([]),c=a([]),i=a(""),L=a(!1),p=a(!1);a("zh");const x=a(""),_=a(null),g=a(null),n=a(null),D=localStorage.getItem("access_token")||"",$=()=>{n.value||(n.value=G(C,{query:{token:D},path:"/socket_for_audio"}),n.value.on("connect",()=>{console.log("Connected to server")}),n.value.on("message",s=>{console.log(s),s.content&&(x.value+=s.content+`
`),console.log(s.content)}),n.value.on("result",s=>{_.value=s.content,p.value=!1}),n.value.on("error",s=>{g.value=s.content}),n.value.on("disconnect",()=>{console.log("Disconnected from server")}))},M=()=>{p.value=!0,n.value||$(),_.value=null,g.value=null,n.value.connected?n.value.emit("start_srt2llmtext",{srt_file:b.value}):console.error("WebSocket connection not established")},V=(s,l)=>{const t=s.target;t.files&&(m.value=Array.from(t.files),c.value=m.value.map(o=>({name:o.name,progress:0})),m.value.forEach((o,v)=>{l==="image"&&!o.type.startsWith("image/")?(i.value=`文件 ${o.name} 不是图片格式，上传失败`,c.value[v].progress=-1):l==="mind"&&!["application/json","application/vnd.xmind.workbook"].includes(o.type)?(i.value=`文件 ${o.name} 不是 JSON 或 XMind 格式，上传失败`,c.value[v].progress=-1):B(o,v)}),m.value=null)},B=(s,l)=>{if(!s){w({title:"success",message:"需要选择1个文件"});return}const t=new FormData;t.append("file",s);const o={...J};delete o["Content-Type"];let v=`${C}/mind/upload_file`;A.post(v,t,{headers:{"Content-Type":"multipart/form-data",...o},onUploadProgress:f=>{c.value[l]&&(c.value[l].progress=Math.round(f.loaded*100/f.total))}}).then(f=>{const h=f.data;h.code===0?(i.value="文件上传成功",w({title:"success",message:`文件上传: ${h.msg}`}),c.value[l].progress=100):(i.value=`文件上传失败: ${h.msg}`,w({title:"success",message:`文件上传: ${h.msg}`}),c.value[l].progress=-1)}).catch(()=>{i.value="文件上传失败",c.value[l].progress=-1,w({title:"error",message:"文件上传失败，服务器异常"})})};return R(async()=>{const s=await I();F.value=s.files,L.value=await W(),$()}),(s,l)=>(u(),r("div",O,[U(q),X,k(e("div",H,[e("input",{type:"file",class:"file-input file-input-bordered file-input-success w-full max-w-xs h-16",onChange:l[0]||(l[0]=t=>V(t,"mind"))},null,32),(u(!0),r(N,null,T(c.value,(t,o)=>(u(),r("div",{key:o},[e("p",null,d(t.name)+" 上传进度: "+d(t.progress)+"%",1),e("progress",{value:t.progress,max:"100"},null,8,K)]))),128)),i.value?(u(),r("div",P,d(i.value),1)):y("",!0)],512),[[S,L.value]]),e("div",Q,[Y,k(e("select",{class:"select select-accent w-full max-w-xs","onUpdate:modelValue":l[1]||(l[1]=t=>b.value=t)},[(u(!0),r(N,null,T(F.value,t=>(u(),r("option",{value:t.name},d(t.name),9,Z))),256))],512),[[j,b.value]]),e("div",null,[e("button",{class:"btn btn-success ml-6",onClick:M},[k(e("span",ee,null,512),[[S,p.value]]),k(e("span",null,"loading",512),[[S,p.value]]),z(" 转换 ")])])]),x.value?(u(),r("div",se,[te,e("p",null,d(x.value),1)])):y("",!0),_.value?(u(),r("div",le,[oe,e("p",null,d(_.value),1)])):y("",!0),g.value?(u(),r("div",ae,[ne,e("p",null,d(g.value),1)])):y("",!0)]))}});export{ve as default};
