import{L as g,y as b,k as w,E as n,A as x,B as k,o as B,b as E,a as j}from"./index-f50d6d08.js";import{i as A}from"./index-cbf34b5d.js";import{u as y}from"./navHeader.vue_vue_type_script_setup_true_lang-f1ba1dcd.js";import{e as C}from"./api-a3faf747.js";const q={class:"w-full h-80 border border-gray-100 overflow-auto bg-green-100"},O=j("div",{id:"plotContainer",class:"w-full h-96 my-10"},null,-1),R=[O],J={__name:"plotEcharts",setup(t){const{display_plot_meta:a}=g(y()),m=b(()=>!!a.value);w(a,(e,s)=>{if(e){console.log("开始绘图",e);const r=e.info,l=r.title,c=e.data;r.type==="bar"?i(c,l):n.warning("抱歉，暂不支持该类型的数据的绘图")}});function i(e,s){console.log(e,s);const r=Object.keys(e),l=Object.values(e);o(r,l,s)}const o=(e,s,r)=>{document.getElementById("plotContainer").setAttribute("_echarts_instance_","");var l=document.getElementById("plotContainer"),c=A(l);const p=["red","green","blue","yellow","purple","pink","orange","gray","black","brown","cyan","magenta","olive","lime","teal","navy","fuchsia","maroon","aqua","gold","silver"],d=s.map((h,v)=>({value:h,itemStyle:{color:p[v%p.length]}})),f={title:{text:r},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:e},series:[{name:"统计",type:"bar",stack:"total",label:{show:!0},emphasis:{focus:"series"},data:d}]};f&&c.setOption(f),window.onresize=()=>{c.resize()}};return(e,s)=>x((B(),E("div",q,R,512)),[[k,m.value]])}},{currentQuestion:_,messages:u,function_results:S,need_summary:T,display_neo4j_meta:D,display_plot_meta:N}=g(y());function $(t){return t instanceof Array?"array":t instanceof Date?"date":t instanceof RegExp?"regexp":typeof t}async function M(){let t="";if(_.value.question)t=_.value.question;else if(u.value[u.value.length-1].role==="function_call")t=u.value[u.value.length-1].content;else{n.error("当前输入中为空而且上一条消息也不是函数调用，无法运行函数");return}let a=JSON.parse(t);$(a)==="object"&&(a=[a]);for(let i of a)try{const o=await C(i),e=o.data;if(console.log("Function result:",e),o.code===0&&e.status){if(e.msg.includes("Traceback")){n({message:`运行函数失败，请检查输入参数或者api,错误信息包括Traceback：${e.msg}`,type:"error"});return}S.value.push(e),T.value=e.need_summary,e.meta.plot==="neo4j"?D.value=e.meta.data:e.meta.plot==="echarts"&&(N.value=e.meta),n({message:"函数运行成功, 是否需要summary:"+e.need_summary,type:"info"})}else n({message:`运行函数失败，请检查输入参数或者api,错误代码出现：${e.msg}`,type:"error"})}catch(o){n({message:`运行函数失败，请检查输入参数或者api,错误没有调用成功：${o}`,type:"error"})}}export{M as R,J as _};
